\documentclass{IEEEtran}

\input{info.tex}
\input{packages.tex}

\begin{document}

% \input{cover.tex}

\begin{abstract}
	Simultaneous Wireless Information and Power Transfer (SWIPT) is severely restricted by the low power level of the receive Radio-Frequency (RF) signal. To tackle this problem, we introduce Intelligent Reflecting Surface (IRS) that brings a high passive beamforming gain to compensate the propagation loss and boost the energy efficiency with a low power consumption. This paper investigates an IRS-aided Orthogonal Frequency Division Multiplexing (OFDM) SWIPT system based on practical nonlinear harvester model, where a multi-antenna Access Point (AP) transmits information and energy simultaneously to a single-antenna user under the assist of IRS. We aim to maximize the Rate-Energy (R-E) region via jointly optimizing the transmit waveform at the AP, the phase shifts at the IRS, and the splitting ratio at the user. The problem is formulated as current maximization problem subject to rate constraint, and we propose an low-complexity alternating algorithm to obtain suboptimal solutions iteratively. Numerical results demonstrated that dedicated power signal is beneficial to multicarrier SWIPT, while IRS brings significant R-E region enlargement over benchmark schemes when properly configured.
\end{abstract}

\begin{section}{Introduction}
	\begin{subsection}{Simultaneous Wireless Information and Power Transfer}
		With the great advance in communication performance (throughput, latency, outage), the main challenge of wireless network has come to energy supply. Most existing mobile devices are powered by batteries that require frequent charging or replacement, which leads to high maintenance cost and thus restricts the scale of networks. Although solar energy and inductive coupling has become popular alternatives, the former depends on the environment while the latter has a very short operation range. Simultaneous Wireless Information and Power Transfer (SWIPT) is a promising solution to connect and power mobile devices via electromagnetic (EM) waves in the Radio-Frequency (RF) band. It provides low power (in \si{\uW} level) but broad coverage (up to hundreds of meters) \cite{Ng2018} in a sustainable and controllable manner. The decreasing trend in electronic power consumption also boosts the paradigm shift from dedicated power source to Wireless Power Transfer (WPT) and SWIPT.

		The concept of SWIPT were first cast in \cite{Varshney2008}, where the authors investigated the Rate-Energy (R-E) tradeoff for a flat Gaussian channel and some discrete channels. Two practical receiver structures were then proposed in \cite{Zhou2013}, namely Time Switching (TS) that switches between Energy Harvesting (EH) and Information Decoding (ID) modes, and Power Splitting (PS) that splits the received signal into individual components. On top of this, \cite{Zhang2013} characterized the R-E region for a Multiple-Input Multiple-Output (MIMO) broadcast system under TS and PS setup. Information and power beamforming was then considered in multiuser Multi-Input Single-Output (MISO) systems to maximize the Weighted Sum-Power (WSP) subjective to Signal-to-Interference-plus-Noise Ratio (SINR) constraints \cite{Xu2014}. Motivated by this, \cite{Krikidis2014} investigated fundamental transceiver modules, information and power scheduling, and interference management for SWIPT systems. However, \cite{Boshkovska2015} pointed out that the Radio Frequency-to-Direct Current (RF-to-DC) conversion efficiency depends on the harvester input power level, which also suggested a parametric harvester model based on curve fitting and proposed an iterative resource allocation algorithm. From another perspective, \cite{Trotter2009,Boaventura2011} demonstrated that multisine waveform is more suitable for WPT as it outperforms single tone in both operation range and RF-to-DC efficiency. \cite{Clerckx2016a} derived a tractable nonlinear harvester model based on the Taylor expansion of diode I-V characteristics and proposed an adaptive waveform optimization algorithm to maximize the output DC current under rate constraints. Simulation and experiments demonstrated the benefit of modelling rectifier nonlinearity in system design \cite{Kim2019,Kim2019a}. The work was extended to SWIPT in \cite{Clerckx2018} where a superposition of modulated information waveform and multisine power waveform is optimized to enlarge the R-E region. In contrast, \cite{Park2018} suggested an adaptive dual-mode SWIPT, which alternates between single-tone transmission that exploits conventional modulation for high-rate applications and multisine transmission that encodes the information in the Peak-to-Average Ratio (PAPR) for power-demanding applications. By assuming On-Off-Keying (OOK) where bit 1 carries energy, \cite{Hu2019} compared unary and Run-Length-Limited (RLL) code in terms of rate vs battery overflow/underflow probability, and adapted conventional modulation schemes to ensure WPT is only activated at the points with large offset. Also, a learning approach \cite{Varasteh2019c} demonstrated that the offset of the power symbol is positively correlated to the harvester energy constraint, while the information symbols are symmetrically distributed around the origin. It confirmed that the superposed waveform is feasible to enlarge R-E region when considering rectifier nonlinearity. SWIPT was also explored in the network design. \cite{Liu2016} proposed a cooperative SWIPT Non-Orthogonal Multiple Access (NOMA) protocol with three user selection schemes such that the strong user assists the EH of the weak user. In \cite{Mao2019}, SWIPT based on Rate Splitting (RS) was formulated as a Weighted Sum-Rate (WSR) maximization problem subject to total harvested energy constraint for separated Information Receivers (IRs) and Energy Receivers (ERs).
	\end{subsection}

	\begin{subsection}{Intelligent Reflecting Surface}
		Intelligent Reflecting Surface (IRS) adapts the wireless environment to increase spectrum and energy efficiency. In practice, an IRS consists of multiple individual reflecting elements that adjust the amplitude and phase of the incident signal through passive beamforming. Different from relay and backscatter communication, IRS assists the primary transmission without any active components, leading to low power consumption and no thermal noise added to the reflected signal. Compared with the linear increase in Amplify-and-Forward (AF) relay, the received power scales quadratically with the number of reflectors \cite{Wu2019}, since more reflectors boost the power collected by IRS and increase the array gain in its equal gain transmission.

		Inspired by the advance in real-time reconfigurable metamaterials \cite{Cui2014}, \cite{Liaskos2018} introduced a programmable metasurface that steers or polarizes the EM wave at specific frequency to mitigate signal attenuation. At the same time, \cite{Tan2018} constructed an adjustable reflect array that ensures reliable millimeter-wave (mmWave) communication based on a beam-searching algorithm to reduce indoor signal blockage. Motivated by this, \cite{Wu2018,Wu2019} introduced an IRS-assisted MISO system and proposed a beamforming algorithm that jointly optimizes the precoder at the Access Point (AP) and the phase shifts at the IRS to maximize Signal-to-Noise Ratio (SNR). The active and passive beamforming problem was extended to the discrete phase shift case \cite{Wu2019a} and the multiuser case \cite{Guo2019a}. In \cite{Nadeem2019}, channel estimation for Time-Division Duplex (TDD) systems was carried through a two-stage Minimum Mean Squared Error (MMSE)-based protocol that sequentially estimates the cascaded channel of each IRS element with the others switched off. Starting from the impedance equation, \cite{Abeywickrama2019} investigated the influence of phase shift on the reflection amplitude and proposed a parametric IRS model via curve fitting. Recent research also explored the opportunity of integrating IRS with Orthogonal Frequency-Division Multiplexing (OFDM) systems. \cite{Yang2019} exploited spatial correlation to reduce estimation overhead and design complexity by assuming adjacent elements share a common reflection coefficient. On top of this, group-based OFDM channel estimation was investigated in \cite{Zheng2019}. By adjusting IRS over time slots, \cite{Yang2020} introduced artificial diversity within coherence time and investigated resource allocation and IRS configuration per Resource Block (RB). Real-time high-definition video transmission was performed over a prototype constructed with Positive Intrinsic-Negative (PIN) diodes, which demonstrated the feasibility and benefit of IRS at GHz and mmWave frequency \cite{Dai2020}.

		Most existing papers assume a Frequency-Flat (FF) IRS where all elements reflect different frequencies equally. Although Frequency-Selective Surface (FSS) has received much attention for wideband communications, it is prohibitive since active FSS requires RF-chains \cite{Kim2006,Xu2014} while passive FSS has fixed physical characteristics and unable to adjust channel adaptively \cite{Anwar2018}.
	\end{subsection}

	\begin{subsection}{IRS-aided SWIPT}
		The effective channel enhancement and low power consumption of IRS are expected to bring more opportunities to SWIPT. Based on linear harvester model and energy interference, \cite{Wu2019b} proved that at most one energy beam is required to maximize the WSP subject to SINR constraints. The fairness issue was then considered in \cite{Tang2019}, which maximize the minimum output power on the assumption of perfect energy interference cancellation. \cite{Wu2019c} proposed a novel penalty-based algorithm, whose inner layer employs Block Coordinate Descent (BCD) method to update precoders, phase shifts and auxiliary variables while the outer layer updates the penalty coefficients. It demonstrated that Line-of-Sight (LoS) links can boost the harvested power, as the rank-deficient channels are highly correlated and a single energy stream can satisfy the energy constraints of all ERs. In \cite{Pan2019a}, the WSR maximization of MIMO SWIPT was first transformed to Weighted Minimum Mean Square Error (WMMSE) problem then solved by BCD with low-complexity iterative algorithms. However, most existing IRS-SWIPT papers focus on narrow-band transmission over linear harvester model.
	\end{subsection}

	\begin{subsection}{Objective and Methodology}
		In this paper, we study an IRS-aided broadband downlink MISO SWIPT system where the IRS assists the information and energy transmission of a single user. A multicarrier unmodulated power waveform (deterministic multisine) is superposed to a multicarrier modulated information waveform (e.g. OFDM) to boost the energy transfer efficiency without introducing additional interference. The transmit waveform, IRS phase shift and receive splitting ratio are jointly optimized to maximize the R-E tradeoff. Different from previous research, this paper focus on broadband SWIPT and investigates the fundamental impact of harvester nonlinearity on IRS design. We transform the R-E region characterization problem into multiple current maximization problems subject to different rate constraints. To reduce the design complexity, we propose an Alternating Optimization (AO) algorithm that updates the channel and transceiver iteratively based on Semi-Definite Relaxation (SDR) and Geometric Programming (GP) technique. Numerical results showed that SDR is tight and the proposed algorithm can find a stationary point for all tested channel realizations. We demonstrate that dedicated power waveform boosts the energy transmission efficiency, such that TS and PS are preferred for low-rate and high-rate applications respectively. Also, IRS brings a significant channel amplification thus R-E enhancement especially when located near the transmitter/receiver, and the performance loss compared with ideal Frequency-Selective (FS) IRS decreases as the number of reflectors increases.
	\end{subsection}
\end{section}

\begin{section}{System Model}
	Consider an IRS-aided SWIPT system where a $M$-antenna transmitter delivers information and power simultaneously, through a $L$-reflector IRS, to a single-antenna user over $N$ orthogonal subbands. We assume a total bandwidth $B$ with evenly-spaced subbands centered at frequency $f_n$ ($n=1,\dots,N$). Perfect Channel State Information (CSI) with negligible training overhead is assumed to explore the analytical upper-bound of the proposed design. A quasi-static block fading channel model is considered for all links, and we focus on one particular block where the channels are approximately unchanged. Two practical co-located receiver architectures are compared in terms of R-E region. Specifically, TS divides each time slot into orthogonal data and energy slots and performs a time sharing between WPT and Wireless Information Transfer (WIT). In comparison, PS splits the received signal into individual ID and EH streams such that the splitting ratio $\rho$ is coupled with waveform and IRS design. Perfect synchronization is assumed among the three parties in both scenarios, and signals reflected by IRS for two and more times are omitted.
	\begin{subsection}{Transmit Signal}
		Denote $\tilde{x}_{I,n}(t)$ as the information symbol transmitted over subband $n$, which follows a capacity-achieving i.i.d. Circular Symmetric Complex Gaussian (CSCG) distribution with zero mean and unit variance $\tilde{x}_{I,n}\sim\mathcal{CN}(0,1)$. The superposed transmit signal on antenna $m$ ($m=1,\dots,M$) at time $t$ is
		\begin{equation}\label{eq:x_m}
			x_m(t)=\Re\left\{\sum_{n=1}^N\left({w_{I,n,m}\tilde{x}_{I,n}(t)}+w_{P,n,m}\right){e^{j2{\pi}{f_n}{t}}}\right\}
		\end{equation}
		where $w_{I/P,n,m}=s_{I/P,n,m}e^{j\psi_{I/P,n,m}}$ denotes the weight on the information and power signal transmitted by antenna $m$ at subband $n$. Define $\boldsymbol{w}_{I/P,n}=[w_{I/P,n,1},\dots,w_{I/P,n,M}]^T \in \mathbb{C}^{M \times 1}$ by stacking up weights across all antennas and let $\boldsymbol{s}_{I/P,n}$, $\boldsymbol{\psi}_{I/P,n}$ be the magnitude and phase of $\boldsymbol{w}_{I/P,n}$. Therefore, the transmit information and power signals write as
		\begin{align}
			\boldsymbol{x}_{I}(t) &= \Re{\left\{\sum_{n=1}^N\boldsymbol{w}_{I,n}\tilde{x}_{I,n}(t){e^{j2{\pi}{f_n}{t}}}\right\}}\label{eq:x_I}\\
			\boldsymbol{x}_{P}(t) &= \Re{\left\{\sum_{n=1}^N\boldsymbol{w}_{P,n}{e^{j2{\pi}{f_n}{t}}}\right\}}\label{eq:x_P}
		\end{align}

		% We also define $\boldsymbol{w}_{I/P}=[\boldsymbol{w}_{I/P,1}^T,\dots,\boldsymbol{w}_{I/P,N}^T]^T \in \mathbb{C}^{MN \times 1}$ and let $\boldsymbol{s}_{I/P}=\lvert{\boldsymbol{w}_{I/P}}\rvert$, $\boldsymbol{\psi}_{I/P}=\angle{\boldsymbol{w}_{I/P}}$ be the waveform magnitude and phase.
	\end{subsection}

	\begin{subsection}{Composite Channel}
		At subband $n$, denote the AP-user direct channel as $\boldsymbol{h}_{D,n}^H \in \mathbb{C}^{1 \times M}$, AP-IRS incident channel as $\boldsymbol{H}_{I,n} \in \mathbb{C}^{L \times M}$, and IRS-user reflective channel as $\boldsymbol{h}_{R,n}^H \in \mathbb{C}^{1 \times L}$. At the IRS, element $l$ ($l=1,\dots,L$) redistributes the incoming signal by adjusting the reflection amplitude $\gamma_l \in [0,1]$ and phase shift $\theta_l \in [0,2\pi)$ \footnote{To investigate the performance upper bound of IRS, we suppose the reflection coefficient is maximized $\gamma_l=1 \ \forall l$ while the phase shift is a continuous variable over $[0,2\pi)$.}. On top of this, the IRS matrix collects the reflection coefficients onto the main diagonal entries as $\boldsymbol{\Theta} = \mathrm{diag}(\gamma_1 e^{j \theta_1}, \dots, \gamma_L e^{j \theta_L}) \in \mathbb{C}^{L \times L}$. The extra link introduced by IRS can be modeled as a concatenation of the AP-IRS channel, IRS reflection, and IRS-user channel. On top of this, the total composite channel is formed by adding the IRS-aided extra channel to the AP-user direct channel as
		\begin{equation}\label{eq:h_n}
			\boldsymbol{h}_{n}^H = \boldsymbol{h}_{D,n}^H + \boldsymbol{h}_{R,n}^H \boldsymbol{\Theta} \boldsymbol{H}_{I,n} = \boldsymbol{h}_{D,n}^H + \boldsymbol{\phi}^H \boldsymbol{V}_{n}
		\end{equation}
		where $\boldsymbol{\phi}=[\gamma_1 e^{j \theta_1}, \dots, \gamma_L e^{j \theta_L}]^H \in \mathbb{C}^{L \times 1}$ and $\boldsymbol{V}_{n}=\mathrm{diag}(\boldsymbol{h}_{R,n}^H)\boldsymbol{H}_{I,n} \in \mathbb{C}^{L \times M}$. Note that the Hermitian transpose in the definition of $\boldsymbol{\phi}$ makes its entries complex conjugate of the diagonal entries of $\boldsymbol{\Theta}$.

		% Similarly, we define $\boldsymbol{h}_k=[\boldsymbol{h}_{k,1}^T,\dots,\boldsymbol{h}_{k,N}^T]^T \in \mathbb{C}^{MN \times 1}$, $\boldsymbol{V}_k=[\boldsymbol{V}_{k,1},\dots,\boldsymbol{V}_{k,N}] \in \mathbb{C}^{L \times MN}$ and let $\boldsymbol{a}_{k}=\lvert \boldsymbol{h}_{k} \rvert$, $\boldsymbol{\varsigma}_{k}=\angle{\boldsymbol{h}_{k}}$ be the magnitude and phase of the composite channel for user $k$.
	\end{subsection}

	\begin{subsection}{Receive Signal}
		At the single-antenna receiver, the total received signal $y(t)=y_I(t)+y_P(t)$ captures the contribution of information and power components over $N$ subbands, where
		\begin{align}\label{eq:y_{I/P}}
			y_{I}(t) & = \Re\left\{\sum_{n=1}^N{\boldsymbol{h}_{n}^H}{\boldsymbol{w}_{I,n}\tilde{x}_{I,n}(t)}{e^{j2{\pi}{f_n}{t}}}\right\}\\
			y_{P}(t) & = \Re\left\{\sum_{n=1}^N{\boldsymbol{h}_{n}^H}\boldsymbol{w}_{P,n}{e^{j2{\pi}{f_n}{t}}}\right\}
		\end{align}
	\end{subsection}

	\begin{subsection}{Information Decoder}
		A major benefit of the proposed waveform is that the determined power waveform creates no interference to the information waveform. Therefore, the achievable rate writes as
		\begin{equation}\label{eq:R}
			R(\boldsymbol{w}_I,\boldsymbol{\phi},\rho)=\sum_{n=1}^N{\log_2\left(1+\frac{(1-\rho)\lvert \boldsymbol{h}_{n}^H\boldsymbol{w}_{I,n} \rvert^2}{\sigma_n^2}\right)}
		\end{equation}
		where $\sigma_n^2$ is the variance of the total noise (RF-band and RF-to-baseband conversion) on tone $n$. Rate \ref{eq:R} is achievable with either waveform cancellation or translated demodulation \cite{Clerckx2018b}.
	\end{subsection}

	\begin{subsection}{Energy Harvester}
		In this section, we briefly revisit a tractable nonlinear rectenna model that relates the harvester output DC current to the received waveform \cite{Clerckx2016a,Clerckx2018b}. Fig. \ref{fi:antenna_equivalent_circuit} illustrates the equivalent circuit of a lossless antenna, where the incoming signal creates an voltage source $v_s(t)$ and the antenna has an impedance $R_{\text{ant}}$. Let $R_{\text{in}}$ be the total input impedance of the rectifier and matching network. Assume the voltage across matching network is negligible and the RF-band noise is too small to harvest. When perfectly matched ($R_{\text{in}}=R_{\text{ant}}$) with power splitting ratio $\rho$, the rectifier input voltage is $v_{\text{in}}(t)=y(t)\sqrt{\rho R_{\text{ant}}}$.

		\begin{figure}
			\centering
			\begin{subfigure}[t]{0.45\linewidth}
				\centering
				\includegraphics[width=\linewidth]{assets/antenna_equivalent_circuit.eps}
				\caption{Antenna equivalent circuit}
				\label{fi:antenna_equivalent_circuit}
			\end{subfigure}%
			~
			\begin{subfigure}[t]{0.45\linewidth}
				\centering
				\includegraphics[width=\linewidth]{assets/single_diode_rectifier.eps}
				\caption{A single diode rectifier}
				\label{fi:single_diode_rectifier}
			\end{subfigure}
			\caption{Rectenna circuit}
		\end{figure}

		Rectifiers consist of nonlinear components as diode and capacitor to produce DC and store energy \cite{Hagerty2004,Pinuela2013}. Consider a simplified rectifier in Fig. \ref{fi:single_diode_rectifier} where a single series diode is followed by a low-pass filter with load. Denote $v_d(t)=v_{\text{in}}(t)-v_{\text{out}}(t)$ as the voltage across the diode where $v_{\text{out}}(t)$ is the output voltage across the load. A Taylor expansion of the diode characteristic equation $i_d(t)=i_s(e^{v_d(t)/n' v_t}-1)$ (with $i_s$ the reverse bias saturation current, $n'$ the diode ideality factor, $v_t$ the thermal voltage) around a quiescent operating point $v_d=a$ writes as $i_d(t)=\sum_{i=0}^{\infty}k_i'(v_d(t)-a)^i$, where $k_0'=i_s(e^{a/n' v_t}-1)$ and $k_i'=i_se^{a/n'v_t}/i!(n'v_t)^i,i=1,\dots,\infty$. Note that this small signal expansion model is only valid for the non-linear operation region, and the I-V relationship would be linear if the diode behavior is dominated by the load \cite{Clerckx2016a}. Also, an ideal low-pass filter with steady-state response can provide a constant $v_{\text{out}}$ that depends on the peak of $v_{\text{in}}(t)$ \cite{Curty2005}. Therefore, a proper choice of the operating voltage drop is $a=\mathcal{E}\{v_d(t)\}=-v_{\text{out}}$ such that
		\begin{equation}\label{eq:i_d}
			i_d(t)=\sum_{i=0}^{\infty}k_i'\rho^{i/2}R_{\text{ant}}^{i/2}y(t)^i
		\end{equation}

		By discarding non-DC components, taking expectation over symbol distribution, and truncating \ref{eq:i_d} to the $n_0$-th order, we approximate the average output DC current for a given channel as
		\begin{equation}\label{eq:i_out}
			i_{\text{out}}(t)=\mathcal{A}\{i_d(t)\}\approx\sum_{i=0}^{\infty}{k_i'}{\rho^{i/2}}{R_{\text{ant}}^{i/2}}\mathcal{E}\left\{{\mathcal{A}\left\{y(t)^i\right\}}\right\}
		\end{equation}

		With the assumption of evenly spaced frequencies, it holds that $\mathcal{A}\left\{y(t)^i\right\}=0$ for odd $i$ thus the related terms has no contribution to DC components. It is also proved in \cite{Clerckx2016a} that maximizing a truncated $i_{\text{out}}$ is equivalent to maximizing a monotonic function
		\begin{equation}\label{eq:z}
			z(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)=\sum_{i\,\text{even},i\ge2}^{n_0}{k_i}{\rho^{i/2}}{R_{\text{ant}}^{i/2}}{\mathcal{E}\left\{\mathcal{A}\left\{y(t)^i\right\}\right\}}
		\end{equation}
		where $k_i=i_s/i!(nv_t)^i$. It can be observed that the traditional linear harvester model, where the output DC power is the sum of the power harvested on each frequency, is a special case of \ref{eq:z} with $n_0=2$. However, due to the coupling among different frequencies, some high-order terms also cancel out non-DC components thus contribute to the output DC power. In other words, even terms with $i \ge 4$ account for the nonlinear behavior of the diode. For simplicity, we choose $n_0=4$ to investigate fundamental nonlinearity and let $\beta_2={k_2}{R_{\text{ant}}}$, $\beta_4={k_4}{R_{\text{ant}}^2}$. Note that $\mathcal{E}\left\{\lvert\tilde{x}_{I,n}\rvert^2\right\}=1$ but $\mathcal{E}\left\{\lvert\tilde{x}_{I,n}\rvert^4\right\}=2$ can be interpreted as a modulation gain on the nonlinear terms of the output DC current.

		Following \cite{Huang2017}, we further stack up channel and waveform vectors over all subbands to define $\boldsymbol{h}=[\boldsymbol{h}_1^T,\dots,\boldsymbol{h}_N^T]^T \in \mathbb{C}^{MN \times 1}$, $\boldsymbol{w}_{I/P}=[\boldsymbol{w}_{I/P,1}^T,\dots,\boldsymbol{w}_{I/P,N}^T]^T \in \mathbb{C}^{MN \times 1}$. Moreover, let $\boldsymbol{W}_{I/P,n}$, $\boldsymbol{H}_{n}$ keep the $n$-th ($n=-N+1,\dots,N-1$) block diagonal of $\boldsymbol{H}=\boldsymbol{h}\boldsymbol{h}^H$, $\boldsymbol{W}_{I/P}=\boldsymbol{w}_{I/P}\boldsymbol{w}_{I/P}^H$ and null the remaining entries, respectively. On top of this, DC terms are expressed in \ref{eq:y_I2} -- \ref{eq:y_P4} and $z$ is reduced to \ref{eq:z_expand} -- \ref{eq:z_expand_2}.
		\begin{figure*}[b]
			\hrule
			\begin{align}
				\mathcal{E}\left\{\mathcal{A}\left\{y_{I}^2(t)\right\}\right\}
				& = \frac{1}{2}\sum_n{(\boldsymbol{h}_{n}^H\boldsymbol{w}_{I,n})(\boldsymbol{h}_{n}^H\boldsymbol{w}_{I,n})^H}\label{eq:y_I2}\\
				& = \frac{1}{2}\boldsymbol{h}^H\boldsymbol{W}_{I,0}\boldsymbol{h} = \frac{1}{2}\boldsymbol{w}_I^H\boldsymbol{H}_{0}\boldsymbol{w}_I\\
				\mathcal{E}\left\{\mathcal{A}\left\{y_{I}^4(t)\right\}\right\}
				& = \frac{3}{4}\left(\sum_n{(\boldsymbol{h}_{n}^H\boldsymbol{w}_{I,n})(\boldsymbol{h}_{n}^H\boldsymbol{w}_{I,n})^H}\right)^2\\
				& = \frac{3}{4}(\boldsymbol{h}^H\boldsymbol{W}_{I,0}\boldsymbol{h})^2 = \frac{3}{4}(\boldsymbol{w}_I^H\boldsymbol{H}_{0}\boldsymbol{w}_I)^2\\
				\mathcal{A}\left\{y_{P}^2(t)\right\}
				& = \frac{1}{2}\sum_n{(\boldsymbol{h}_{n}^H\boldsymbol{w}_{P,n})(\boldsymbol{h}_{n}^H\boldsymbol{w}_{P,n})^H}\\
				& = \frac{1}{2}\boldsymbol{h}^H\boldsymbol{W}_{P,0}\boldsymbol{h} = \frac{1}{2}\boldsymbol{w}_P^H\boldsymbol{H}_{0}\boldsymbol{w}_P\\
				\mathcal{A}\left\{y_{P}^4(t)\right\}
				& = \frac{3}{8}\sum_{\substack{{n_1},{n_2},{n_3},{n_4}\\{n_1}+{n_2}={n_3}+{n_4}}}{(\boldsymbol{h}_{{n_1}}^H\boldsymbol{w}_{P,{n_1}})(\boldsymbol{h}_{{n_2}}^H\boldsymbol{w}_{P,{n_2}})(\boldsymbol{h}_{{n_3}}^H\boldsymbol{w}_{P,{n_3}})^H(\boldsymbol{h}_{{n_4}}^H\boldsymbol{w}_{P,{n_4}})^H}\\
				& = \frac{3}{8}\sum_{n=-N+1}^{N-1}(\boldsymbol{h}^H\boldsymbol{W}_{P,n}\boldsymbol{h})(\boldsymbol{h}^H\boldsymbol{W}_{P,n}\boldsymbol{h})^H = \frac{3}{8}\sum_{n=-N+1}^{N-1}(\boldsymbol{w}_P^H\boldsymbol{H}_{n}\boldsymbol{w}_P)(\boldsymbol{w}_P^H\boldsymbol{H}_{n}\boldsymbol{w}_P)^H\label{eq:y_P4}
			\end{align}
		\end{figure*}
		\begin{figure*}[b]
			\hrule
			\begin{align}
				z(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)
				& = \beta_2\rho\Bigl(\mathcal{E}\left\{\mathcal{A}\left\{y_{I}^2(t)\right\}\right\}+\mathcal{A}\left\{y_{P}^2(t)\right\}\Bigr)+\beta_4\rho^2\Bigl(\mathcal{E}\left\{\mathcal{A}\left\{y_{I}^4(t)\right\}\right\}+\mathcal{A}\left\{y_{P}^4(t)\right\}+6\mathcal{E}\left\{\mathcal{A}\left\{y_{I}^2(t)\right\}\right\}\mathcal{A}\left\{y_{P}^2(t)\right\}\Bigr)\label{eq:z_expand}\\
				& = \frac{1}{2}\beta_2\rho(\boldsymbol{h}^H\boldsymbol{W}_{I,0}\boldsymbol{h}+\boldsymbol{h}^H\boldsymbol{W}_{P,0}\boldsymbol{h})\nonumber\\
				& \quad+ \frac{3}{8}\beta_4\rho^2 \left(2(\boldsymbol{h}^H\boldsymbol{W}_{I,0}\boldsymbol{h})^2 + \sum_{n=-N+1}^{N-1} (\boldsymbol{h}^H\boldsymbol{W}_{P,n}\boldsymbol{h})(\boldsymbol{h}^H\boldsymbol{W}_{P,n}\boldsymbol{h})^H\right)\nonumber\\
				& \quad+ \frac{3}{2}\beta_4\rho^2(\boldsymbol{h}^H\boldsymbol{W}_{I,0}\boldsymbol{h})(\boldsymbol{h}^H\boldsymbol{W}_{P,0}\boldsymbol{h})\label{eq:z_expand_1}\\
				& = \frac{1}{2}\beta_2\rho(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I+\boldsymbol{w}_P^H\boldsymbol{H}_{k,0}\boldsymbol{w}_P)\nonumber\\
				& \quad+ \frac{3}{8}\beta_4\rho^2 \left(2(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I)^2 + \sum_{n=-N+1}^{N-1}(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}\boldsymbol{w}_P)(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}\boldsymbol{w}_P)^H \right)\nonumber\\
				& \quad+ \frac{3}{2}\beta_4\rho^2(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I)(\boldsymbol{w}_P^H\boldsymbol{H}_{k,0}\boldsymbol{w}_P)\label{eq:z_expand_2}
			\end{align}
		\end{figure*}
	\end{subsection}

	\begin{subsection}{Weighted Sum Rate-Energy Region}
		Define the achievable weighted sum R-E region as
		\begin{equation}
			\begin{split}
				C_{R-Z}(P)
				&\triangleq \biggl\{(R,Z):R\le\sum_{k=1}^K{u_{I,k}R_k},Z\le\sum_{k=1}^K u_{P,k}z,\\
				&\quad \frac{1}{2}({\boldsymbol{w}_I^H}{\boldsymbol{w}_I}+{\boldsymbol{w}_P^H}{\boldsymbol{w}_P}) \le P\biggr\}
			\end{split}
		\end{equation}
		where $P$ is the transmit power budget and $u_{I,k},u_{P,k}$ are the information and power weight of user $k$.
	\end{subsection}
\end{section}

\begin{section}{Single-User Optimization}
	Consider a single-user waveform and IRS optimization problem where $\boldsymbol{\alpha}=\boldsymbol{1}^{N \times 1}$. We characterize the rate-energy region through a current maximization problem subject to transmit power, rate, and IRS constraints
	\begin{maxi!}
		{\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho}{z(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)}{\label{op:su}}{\label{eq:su_target}}
		\addConstraint{\frac{1}{2}({\boldsymbol{w}_I^H}{\boldsymbol{w}_I}+{\boldsymbol{w}_P^H}{\boldsymbol{w}_P})\le{P}}
		\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\lvert(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\boldsymbol{w}_{I,n}\rvert^2}{\sigma_n^2}\right)} \ge \bar{R}}\label{eq:su_rate_constraint}
		\addConstraint{\lvert{\phi_l}\rvert=1, \quad l=1,\dots,L}
		\addConstraint{0 \le \rho \le 1}
	\end{maxi!}
	Problem \ref{op:su} is intricate due to coupled variables and non-convex objective function \ref{eq:su_target} and constraint \ref{eq:su_rate_constraint}. To reduce the design complexity, we propose an suboptimal AO algorithm that updates the IRS phase shift, transmit waveform, and receive splitting ratio iteratively.

	\begin{subsection}{IRS Phase Shift}
		We optimize the IRS phase shift $\boldsymbol{\phi}$ for any given waveform $\boldsymbol{w}_{I/P,n}$ and splitting ratio $\rho$. Since
		\begin{equation}\label{eq:h_n_outer_product}
			\begin{split}
				\boldsymbol{h}_n\boldsymbol{h}_n^H
				&=(\boldsymbol{h}_{D,n}+\boldsymbol{V}_n^H\boldsymbol{\phi})(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\\
				&=\boldsymbol{h}_{D,n}\boldsymbol{h}_{D,n}^H+\boldsymbol{V}_n^H\boldsymbol{\phi}\boldsymbol{h}_{D,n}^H+\boldsymbol{h}_{D,n}\boldsymbol{\phi}^H\boldsymbol{V}_n+\boldsymbol{V}_n^H\boldsymbol{\phi}\boldsymbol{\phi}^H\boldsymbol{V}_n\\
				&=\boldsymbol{M}_n^H\boldsymbol{\Phi}\boldsymbol{M}_n
			\end{split}
		\end{equation}
		where $t$ is an auxiliary variable with unit modulus and
		\begin{equation}\label{eq:M_n,phi}
			\boldsymbol{M}_n=
			\begin{bmatrix}
				\boldsymbol{V}_n \\
				\boldsymbol{h}_{D,n}^H
			\end{bmatrix} \in \mathbb{C}^{(L+1) \times M},
			\quad \bar{\boldsymbol{\phi}}=\
			\begin{bmatrix}
				\boldsymbol{\phi} \\
				t
			\end{bmatrix},
			\quad \boldsymbol{\Phi}=\bar{\boldsymbol{\phi}}\bar{\boldsymbol{\phi}}^H
		\end{equation}
		Therefore, it holds that
		\begin{equation}
			\begin{split}
				\lvert(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\boldsymbol{w}_{I,n}\rvert^2
				&=\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H\boldsymbol{\Phi}\boldsymbol{M}_n\boldsymbol{w}_{I,n}\\
				&=\mathrm{Tr}(\boldsymbol{M}_n\boldsymbol{w}_{I,n}\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H\boldsymbol{\Phi})\\
				&=\mathrm{Tr}(\boldsymbol{C}_n\boldsymbol{\Phi})
			\end{split}
		\end{equation}
		with
		\begin{equation}\label{eq:C_n}
			\boldsymbol{C}_n = \boldsymbol{M}_n\boldsymbol{w}_{I,n}\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H \in \mathbb{C}^{(L+1)\times(L+1)}
		\end{equation}
		Similarly, we have
		\begin{equation}
			\boldsymbol{h}\boldsymbol{h}^H=\boldsymbol{M}^H\boldsymbol{\Phi}\boldsymbol{M}
		\end{equation}
		where
		\begin{equation}\label{eq:M}
			\boldsymbol{M}=
			\begin{bmatrix}
				\boldsymbol{V} \\
				\boldsymbol{h}_D^H
			\end{bmatrix} \in \mathbb{C}^{(L+1) \times MN}
		\end{equation}
		Next, introduce auxiliary variables
		\begin{equation}\label{eq:t}
			\begin{split}
				t_{I/P,n}
				&=\boldsymbol{h}^H\boldsymbol{W}_{I/P,n}^*\boldsymbol{h}\\
				&=\mathrm{Tr}(\boldsymbol{h}\boldsymbol{h}^H\boldsymbol{W}_{I/P,n}^*)\\
				&=\mathrm{Tr}(\boldsymbol{M}^H\boldsymbol{\Phi}\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*)\\
				&=\mathrm{Tr}(\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*\boldsymbol{M}^H\boldsymbol{\Phi})\\
				&=\mathrm{Tr}(\boldsymbol{C}_{I/P,n}\boldsymbol{\Phi})
			\end{split}
		\end{equation}
		with
		\begin{equation}\label{eq:C_{I/P,n}}
			\boldsymbol{C}_{I/P,n}=\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*\boldsymbol{M}^H \in \mathbb{C}^{(L+1)\times(L+1)}
		\end{equation}
		Therefore, \ref{eq:z_channel} rewrites as
		\begin{equation}\label{eq:z_irs}
			\begin{split}
				z(\boldsymbol{\Phi})
				&=\frac{1}{2}{\beta_2}{\rho}(t_{I,0}+t_{P,0})\\
				&\quad+\frac{3}{8}{\beta_4}{\rho^2} \left(2t_{I,0}^2 + \sum_{n=-N+1}^{N-1}{t_{P,n}t_{P,n}^*}\right)\\
				&\quad+\frac{3}{2}{\beta_4}{\rho^2}t_{I,0}t_{P,0}
			\end{split}
		\end{equation}
		We use first-order Taylor expansion to approximate the second-order terms in \ref{eq:z_irs}. Based on the variables optimized at iteration $i - 1$, the local approximation at iteration $i$ suggests \cite{Adali2010}
		\begin{align}
			(t_{I,0}^{(i)})^2
			& \ge 2 t_{I,0}^{(i)}t_{I,0}^{(i-1)} - (t_{I,0}^{(i-1)})^2\label{eq:t_{I,0}_square}\\
			t_{P,n}^{(i)} (t_{P,n}^{(i)})^*
			& \ge 2 \Re\left\{t_{P,n}^{(i)} (t_{P,n}^{(i-1)})^*\right\} - t_{P,n}^{(i-1)} (t_{P,n}^{(i-1)})^*\\
			t_{I,0}^{(i)} t_{P,0}^{(i)}
			& = \frac{1}{4}(t_{I,0}^{(i)} + t_{P,0}^{(i)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\nonumber\\
			& \ge \frac{1}{2}(t_{I,0}^{(i)} + t_{P,0}^{(i)})(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})\nonumber\\
			& \quad - \frac{1}{4}(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\label{eq:t_{I/P,0}}
		\end{align}
		\ref{eq:t_{I,0}_square} -- \ref{eq:t_{I/P,0}} provide lower bounds to the corresponding terms in \ref{eq:z_irs}, and the approximated current function at iteration $i$ is given in \ref{eq:z_irs_approx}.
		\begin{figure*}[b]
			\hrule
			\begin{equation}\label{eq:z_irs_approx}
				\begin{split}
					\tilde{z}(\boldsymbol{\Phi}^{(i)})
					& = \frac{1}{2}{\beta_2}{\rho}(t_{I,0}^{(i)}+t_{P,0}^{(i)})\\
					& \quad + \frac{3}{8}{\beta_4}{\rho^2} \left(4 (t_{I,0}^{(i)})(t_{I,0}^{(i-1)}) - 2 (t_{I,0}^{(i-1)})^2 + \sum_{n=-N+1}^{N-1}{2 \Re\left\{t_{P,n}^{(i)} (t_{P,n}^{(i-1)})^*\right\} - t_{P,n}^{(i-1)} (t_{P,n}^{(i-1)})^*}\right)\\
					& \quad + \frac{3}{2}{\beta_4}{\rho^2} \left(\frac{1}{2}(t_{I,0}^{(i)} + t_{P,0}^{(i)})(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)}) - \frac{1}{4}(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\right)
				\end{split}
			\end{equation}
		\end{figure*}
		Hence, problem \ref{op:su} is transformed to
		\begin{maxi!}
			{\boldsymbol{\boldsymbol{\Phi}}}{\tilde{z}(\boldsymbol{\Phi})}{\label{op:su_irs}}{\label{eq:su_irs_target}}
			\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\mathrm{Tr}(\boldsymbol{C}_n\boldsymbol{\Phi})}{\sigma_n^2}\right)} \ge \bar{R}}
			\addConstraint{\boldsymbol{\Phi}_{l,l}=1, \quad l=1,\dots,L+1}
			\addConstraint{\boldsymbol{\Phi}\succeq{0}}
			\addConstraint{\mathrm{rank}(\boldsymbol{\Phi})=1\label{co:irs_rank}}
		\end{maxi!}
		We then relax the rank constraint \ref{co:irs_rank} and solve the optimal IRS matrix $\boldsymbol{\Phi}^{\star}$ iteratively by interior-point method. If $\mathrm{rank}(\boldsymbol{\Phi}^{\star})=1$, the optimal phase shift vector $\bar{\boldsymbol{\phi}}^\star$ is attained by eigenvalue decomposition (EVD). Otherwise, a solution can be extracted through Gaussian randomization method \cite{Huang2010}. We first perform EVD on $\boldsymbol{\Phi}^{\star}$ as $\boldsymbol{\Phi}^{\star}=\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}^H$. Then, we generate $Q$ CSCG random vectors $\boldsymbol{r}_q \sim \mathcal{CN}(\boldsymbol{0},\boldsymbol{I}_{L+1}),\ q=1,\dots,Q$ and construct the corresponding candidates by
		\begin{equation}
			\bar{\boldsymbol{\phi}}_q=e^{j\arg\left(\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q\right)}
		\end{equation}
		The candidate maximizing the objective function \ref{eq:su_irs_target} is chosen as the optimal solution $\bar{\boldsymbol{\phi}}^\star$. Finally, we can retrieve the phase shift by $\theta_l=\arg(\phi_l^\star/\phi_{L+1}^\star), \ l=1,\dots,L$. The algorithm for the phase shift optimization is summarized in Algorithm \ref{al:ff_irs}.
		\begin{algorithm}
			\caption{IRS Phase Shift}
			\label{al:ff_irs}
			\begin{algorithmic}[1]
				\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,Q,\bar{R},\epsilon,\rho,\boldsymbol{w}_{I/P},\sigma_n \ \forall n$
				\State \textbf{Initialize} $i \gets 0,\boldsymbol{\Phi}^{(0)},t_{I/P,n}^{(0)}\ \forall n$ by \ref{eq:t}
				\State Construct $\boldsymbol{M},\boldsymbol{M}_n,\boldsymbol{C}_{n},\boldsymbol{C}_{I/P,n} \ \forall n$ by \ref{eq:M}, \ref{eq:M_n,phi}, \ref{eq:C_n}, \ref{eq:C_{I/P,n}}
				\Repeat;
				\State $i \gets i + 1$
				\State Obtain IRS matrix $\boldsymbol{\Phi}^{(i)}$ by solving problem \ref{op:su_irs}
				\State Update auxiliary $t_{I/P,n}^{(i)} \forall n$ by \ref{eq:t} for SCA
				\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
				\State Perform EVD $\boldsymbol{\Phi}^{\star}=\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}^H$
				\State Generate CSCG random vectors $\boldsymbol{r}_q \sim \mathcal{CN}(\boldsymbol{0},\boldsymbol{I}_{L+1}) \ \forall q$
				\State Construct candidate IRS vectors $\bar{\boldsymbol{\phi}}_q=e^{j\arg\left(\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q\right)}$ and matrices $\boldsymbol{\Phi}_q=\bar{\boldsymbol{\phi}}_q\bar{\boldsymbol{\phi}}_q^H  \ \forall q$
				\State Select the best solution $\boldsymbol{\Phi}^\star$ and $\bar{\boldsymbol{\phi}}^\star$ for problem \ref{op:su_irs}
				\State Compute phase shift by $\theta_l^\star=\arg(\phi_l^\star/\phi_{L+1}^\star), \ l=1,\dots,L$
				\State \textbf{Output} $\theta_l^\star \ \forall l$
			\end{algorithmic}
		\end{algorithm}
	\end{subsection}

	\begin{subsection}{Waveform and Splitting Ratio}
		\begin{subsubsection}{Geometric Programming}
			Following \cite{Clerckx2018b}, it can be observed from \ref{eq:R} and \ref{eq:z_expand} -- \ref{eq:z_waveform} that the optimal phases of information and power waveform are both match to the composite channel as
			\begin{equation}\label{eq:psi}
				\boldsymbol{\psi}_{I}^{\star}=\boldsymbol{\psi}_{P}^{\star}=-\boldsymbol{\varsigma}
			\end{equation}
			By such a phase selection, we have
			\begin{equation}
				\lvert{\boldsymbol{h}_n^H\boldsymbol{w}_{I,n}}\rvert^2=(\boldsymbol{a}_n^H\boldsymbol{s}_{I,n})^2=\sum_{m_1,m_2}\prod_{j=1}^2{a_{n,m}s_{I,n,m}} \triangleq E_n
			\end{equation}
			Therefore, the original problem \ref{op:su} is reduced to an amplitude optimization problem
			\begin{maxi!}
					{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho}{z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}{\label{op:su_gp}}{}
					\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P})\le{P}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)E_n}{\sigma_n^2}\right)} \ge \bar{R}}
				\end{maxi!}
			\begin{figure*}[b]
				\hrule
				\begin{equation}\label{eq:z_gp}
					\begin{split}
						z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)
						& = \frac{1}{2}{\beta_2}{\rho} \sum_{n=1}^N \sum_{m_1,m_2} \left( \prod_{j=1}^2 {a_{n,m_j}s_{I,n,m_j}} + \prod_{j=1}^2 {a_{n,m_j}s_{P,n,m_j}} \right)\\
						& \quad + \frac{3}{8}{\beta_4}{\rho^2} \left( \sum_{n_1,n_2} \sum_{m_1,m_2,m_3,m_4} \prod_{j=1,3} a_{n_1,m_j}s_{I,n_1,m_j} \prod_{j=2,4} a_{n_2,m_j}s_{I,n_2,m_j} + \sum_{\substack{{n_1},{n_2},{n_3},{n_4}\\{n_1}+{n_2}={n_3}+{n_4}}} \sum_{m_1,m_2,m_3,m_4} \prod_{j=1}^4 a_{n_j,m_j}s_{P,n_j,m_j} \right)\\
						& \quad + \frac{3}{2}{\beta_4}{\rho^2} \left( \sum_{n_1,n_2} \sum_{m_1,m_2,m_3,m_4} \prod_{j=1,3} a_{n_1,m_j}s_{I,n_1,m_j} \prod_{j=2,4} a_{n_2,m_j}s_{P,n_2,m_j} \right)
					\end{split}
				\end{equation}
			\end{figure*}
			with $z$ expressed in \ref{eq:z_gp}. We introduce an auxiliary variable $t''$ and rewrite problem \ref{op:su_gp} as
			\begin{mini!}
					{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho,\bar{\rho},t''}{\frac{1}{t''}}{\label{op:su_gp_1}}{}
					\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P}) \le P}
					\addConstraint{\frac{t''}{z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)} \le 1}
					\addConstraint{\frac{2^{\bar{R}}}{\prod_n \left(1+{\bar{\rho}E_n}/{\sigma_n^2}\right)} \le 1}
					\addConstraint{\rho + \bar{\rho} \le 1}
				\end{mini!}
			Problem \ref{op:su_gp_1} can be transformed into standard GP by first decomposing the information and power posynomials as sum of monomials, then deriving their upper bounds using Arithmetic Mean-Geometric Mean (AM-GM) inequality \cite{Clerckx2018b,Chiang2005}. Specifically, define
			\begin{align}
				z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)&=\sum_{m_P}{g_{m_P}(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}\\
				1+\frac{\bar{\rho}E_n}{\sigma_n^2}&=\sum_{m_{I,n}}g_{m_{I,n}}(\boldsymbol{s}_{I,n},\bar{\rho})
			\end{align}
			On top of this, problem \ref{op:su_gp_1} is equivalent to
			\begin{mini}
				{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho,\bar{\rho},t''}{\frac{1}{t''}}{\label{op:su_gp_2}}{}
				\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P})\le{P}}
				\addConstraint{{t''}\prod_{m_P}{\left(\frac{g_{{m_P}}(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}{\gamma_{{m_P}}}\right)^{-\gamma_{{m_P}}}}\le{1}}
				\addConstraint{2^{\bar{R}}\prod_{n}\prod_{m_{I,n}}\left(\frac{g_{m_{I,n}}(\boldsymbol{s}_{I,n},\bar{\rho})}{\gamma_{m_{I,n}}}\right)^{-\gamma_{m_{I,n}}}\le{1}}
				\addConstraint{\rho + \bar{\rho} \le 1}
			\end{mini}
			where $\gamma_{m_P},\gamma_{m_{I,n}} \ge 0$ and $\sum_{m_P}\gamma_{m_P}=\sum_{m_{I,n}}\gamma_{m_{I,n}}=1$. The tightness of the AM-GM inequality depends on $\{\gamma_{m_P},\gamma_{m_{I,n}}\}$ that require successive update \cite{Clerckx2018b}. At iteration $i$, we choose
			\begin{align}
				\gamma_{m_{I,n}}^{(i)} & = \frac{g_{m_{I,n}}(\boldsymbol{s}_{I,n}^{(i-1)},\bar{\rho}^{(i-1)})}{1+{\bar{\rho}^{(i-1)}E_n^{(i-1)}}/{\sigma_n^2}}\label{eq:gamma_I}\\
				\gamma_{m_P}^{(i)} & = \frac{g_{m_P}(\boldsymbol{s}_I^{(i-1)},\boldsymbol{s}_P^{(i-1)},\rho^{(i-1)})}{z(\boldsymbol{s}_I^{(i-1)},\boldsymbol{s}_P^{(i-1)},\rho^{(i-1)})}\label{eq:gamma_P}
			\end{align}
			then solve problem \ref{op:su_gp_2}. The GP algorithm is summarized in Algorithm \ref{al:waveform_split_ratio_gp}.
			\begin{algorithm}
				\caption{GP: Waveform and Splitting Ratio}
				\label{al:waveform_split_ratio_gp}
				\begin{algorithmic}[1]
					\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h},P,\bar{R},\epsilon,\sigma_n \ \forall n$
					\State \textbf{Initialize} $i \gets 0$, $\boldsymbol{s}_{I/P}^{(0)}$, $\rho^{(0)}$
					\State Retrieve channel magnitude and phase $\boldsymbol{a}, \varsigma$
					\Repeat
					\State $i \gets i + 1$
					\State Update GM exponents $\{\gamma_{m_P},\gamma_{m_{I,n}}\}$ by \ref{eq:gamma_I}, \ref{eq:gamma_P}
					\State Obtain waveform amplitude $\boldsymbol{s}_{I/P}^{(i)}$ and power splitting ratio $\rho^{(i)}$ by solving problem \ref{op:su_gp_2}
					\State Compute output DC current $z^{(i)}$ by \ref{eq:z_gp}
					\Until $\lvert (z^{(i)} - z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
					\State Recover waveform $\boldsymbol{w}_{I/P}^{\star}$ by \ref{eq:psi}
					\State \textbf{Output} $\boldsymbol{w}_{I/P}^{\star}, \rho^{\star}$
				\end{algorithmic}
			\end{algorithm}
		\end{subsubsection}

		\begin{subsubsection}{Semi-Definite Relaxation}
			In this case, waveform and splitting ratio are updated iteratively until convergence.
			\begin{paragraph}{Transmit Waveform}
				Consider the waveform optimization subproblem. Once $\boldsymbol{\phi}$ and $\rho$ are obtained, introduce auxiliary variables
				\begin{equation}\label{eq:t'}
					t_{I/P,n}' = \boldsymbol{w}_{I/P}^H \boldsymbol{H}_n^* \boldsymbol{w}_{I/P} = \mathrm{Tr}(\boldsymbol{H}_n^*\boldsymbol{W}_{I/P})
				\end{equation}
				Therefore, \ref{eq:z_waveform} rewrites as
				\begin{equation}\label{eq:z_waveform}
					\begin{split}
						z(\boldsymbol{W}_I,\boldsymbol{W}_P)
						&=\frac{1}{2} \beta_2 \rho (t'_{I,0}+t'_{P,0})\\
						&\quad+\frac{3}{8} \beta_4 \rho^2 \left(2(t'_{I,0})^2 + \sum_{n=-N+1}^{N-1}{t'_{P,n}(t'_{P,n})^*}\right)\\
						&\quad+\frac{3}{2} \beta_4 \rho^2 t'_{I,0}t'_{P,0}
					\end{split}
				\end{equation}
				Since \ref{eq:z_waveform} and \ref{eq:z_irs} are in the same form, we reuse \ref{eq:t_{I,0}_square} -- \ref{eq:t_{I/P,0}} and bound $z(\boldsymbol{W}_I,\boldsymbol{W}_P)$ by replacing $t_{I/P,n}$ with $t_{I/P,n}'$ in \ref{eq:z_irs_approx}. Also, denote $\boldsymbol{W}_{I,n}'$ as the $n$-th block in the main diagonal of $\boldsymbol{W}_{I}$ such that
				\begin{equation}
					\lvert{\boldsymbol{h}_n^H\boldsymbol{w}_{I,n}}\rvert^2=\boldsymbol{w}_{I,n}^H\boldsymbol{h}_n\boldsymbol{h}_n^H\boldsymbol{w}_{I,n}=\mathrm{Tr}(\boldsymbol{h}_n\boldsymbol{h}_n^H\boldsymbol{W}_{I,n}')
				\end{equation}
				Hence, problem \ref{op:su} is transformed to
				\begin{maxi!}
					{\boldsymbol{W}_I,\boldsymbol{W}_P}{\tilde{z}(\boldsymbol{W}_I,\boldsymbol{W}_P)}{\label{op:su_waveform}}{\label{eq:su_waveform_target}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\mathrm{Tr}(\boldsymbol{h}_n\boldsymbol{h}_n^H\boldsymbol{W}_{I,n}')}{\sigma_n^2}\right)} \ge \bar{R}\label{eq:su_waveform_constraint}}
					\addConstraint{\frac{1}{2}\left(\mathrm{Tr}(\boldsymbol{W}_I)+\mathrm{Tr}(\boldsymbol{W}_P)\right) \le P}
					\addConstraint{\boldsymbol{W}_{I/P} \succeq 0}
					\addConstraint{\mathrm{rank}(\boldsymbol{W}_{I/P})=1\label{co:waveform_rank}}
				\end{maxi!}
				We then perform SDR and solve the optimal waveform matrix $\boldsymbol{W}_{I/P}^{\star}$ iteratively by interior-point method. $\boldsymbol{w}_I^{\star}$ and $\boldsymbol{w}_P^{\star}$ can be extracted using randomized vectors $\boldsymbol{r}_q \in \mathbb{C}^{MN \times 1}$ whose entries are uniformly distributed on the unit circle. The algorithm is summarized in Algorithm \ref{al:waveform_sdr}.
				\begin{algorithm}
					\caption{SDR: Transmit Waveform}
					\label{al:waveform_sdr}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,P,Q,\bar{R},\epsilon,\rho,\sigma_n \ \forall n$
						\State \textbf{Initialize} $i \gets 0$, $\boldsymbol{W}_{I/P}^{(0)}$, $t_{I/P,n}^{\prime (0)} \ \forall n$ by \ref{eq:t'}
						\State Construct $\boldsymbol{H}_n \ \forall n$
						\Repeat
						\State $i \gets i + 1$
						\State Obtain waveform matrices $\boldsymbol{W}_{I/P}^{(i)}$ by solving problem \ref{op:su_waveform}
						\State Update auxiliary $t_{I/P,n}^{\prime (i)} \forall n$ by \ref{eq:t'} for SCA
						\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
						\State Perform EVD $\boldsymbol{W}_{I/P}^{\star}=\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}^H$
						\State Generate random vectors $\boldsymbol{r}_q \ \forall q$ with entries uniformly distributed on the unit circle
						\State Construct candidate waveform vectors $\boldsymbol{w}_{I/P,r}=\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{W}_{I/P}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q$ and matrices $\boldsymbol{W}_{I/P,q}=\boldsymbol{w}_{I/P,q}\boldsymbol{w}_{I/P,q}^H  \ \forall q$
						\State Select the best solution $\boldsymbol{W}_{I/P}^\star$ and $\boldsymbol{w}_{I/P}^\star$ for problem \ref{op:su_waveform}
						\State \textbf{Output} $\boldsymbol{w}_{I/P}^\star$
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}

			\begin{paragraph}{Receive Splitting Ratio}
				We then optimize the power splitting ratio $\rho$ for any fixed phase shift $\boldsymbol{\phi}$ and waveform $\boldsymbol{w}_{I/P}$. In this case, $z(\rho)$ is also expressed in \ref{eq:z_waveform} with constant $t_{I/P,n}'$ given by \ref{eq:t'}. Since $z(\rho)$ is a quadratic function that monotonically increases over $\rho \in [0, 1]$, we replace the convex objective function with affine $\rho$ and transform problem \ref{op:su} to
				\begin{maxi!}
					{\rho}{\rho}{\label{op:su_ratio}}{\label{eq:su_ratio_target}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\lvert \boldsymbol{h}_n^H \boldsymbol{w}_n \rvert^2}{\sigma_n^2}\right)} \ge \bar{R}\label{eq:su_ratio_constraint}}
					\addConstraint{0 \le \rho \le 1}
				\end{maxi!}
				The optimal power splitting ratio $\rho^\star$ can be obtained by solving problem \ref{op:su_ratio}.
			\end{paragraph}

			\begin{paragraph}{Inner Loop}
				As summarized in Algorithm \ref{al:inner_loop}, the inner loop updates the waveform and splitting ratio iteratively until convergence.
				\begin{algorithm}
					\caption{Inner Loop: Waveform and Splitting Ratio}
					\label{al:inner_loop}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,P,Q,\bar{R},\epsilon,\rho,\sigma_n \ \forall n$
						\State \textbf{Initialize} $\boldsymbol{w}_{I/P}^{(0)}$
						\State $i \gets 0$
						\Repeat
						\State $i \gets i + 1$
						\State Update splitting ratio $\rho^{(i)}$ by solving problem \ref{op:su_ratio}
						\State Update waveform $\boldsymbol{w}_{I/P}^{(i)}$ by Algorithm \ref{al:waveform_sdr}
						\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
						\State \textbf{Output} $\boldsymbol{w}_{I/P}^{\star}, \rho^{\star}$
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}
		\end{subsubsection}
	\end{subsection}

	\begin{subsection}{R-E Region Characterization}
		To characterize the R-E region, we initialize the algorithm to WPT mode and increase the rate constraint gradually to obtain $S$ boundary points. At each point, information and power waveform are initialized to WIT and WPT solutions.
		\begin{subsubsection}{WIT}
			Consider a rate maximization problem with given information waveform $\boldsymbol{w}_I$ as
			\begin{maxi!}
					{\boldsymbol{\Phi}}{\sum_{n}{\log_2\left(1+\frac{\mathrm{Tr}(\boldsymbol{C}_n\boldsymbol{\Phi})}{\sigma_n^2}\right)}}{\label{op:su_irs_wit}}{}
					\addConstraint{\boldsymbol{\Phi}_{l,l}=1, \quad l=1,\dots,L+1}
					\addConstraint{\boldsymbol{\Phi}\succeq{0}}
					\addConstraint{\mathrm{rank}(\boldsymbol{\Phi})=1}
				\end{maxi!}
			Problem \ref{op:su_irs_wit} can be solved after SDR, and a best solution $\bar{\boldsymbol{\phi}}^\star$ can be obtained via Gaussian randomization method. $\boldsymbol{\phi}^\star$ can be recovered by $\phi_l^\star=\phi_l^\star/\phi_{L+1}^\star, \ l=1,\dots,L$ and $\boldsymbol{h}$ can be constructed by \ref{eq:h_n}. On top of this, the optimal information waveform can be obtained by Maximum-Ratio Transmission (MRT). The IRS phase shift and information waveform are updated iteratively until convergence.
		\end{subsubsection}

		\begin{subsubsection}{WPT}
			The current maximization problem can be solved by setting $\rho = 1$, removing the rate constraint in problem \ref{op:su_irs} and \ref{op:su_waveform} then solving them iteratively.
		\end{subsubsection}

		\begin{subsubsection}{R-E Sample}
			We propose a two-layer AO algorithm to maximize the R-E region where the outer loop updates the phase shifts and the inner loop updates the splitting ratio and waveform until convergence. It is summarized in Algorithm \ref{al:ff_ao}.
			\begin{algorithm}
				\caption{Outer Loop: Phase Shift, Waveform and Splitting Ratio}
				\label{al:ff_ao}
				\begin{algorithmic}[1]
					\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D, \boldsymbol{h}_I, \boldsymbol{h}_R, P, Q, S, \epsilon, \sigma_n \ \forall n$
					\State \textbf{Initialize} $i \gets 0, \boldsymbol{\phi}^{(0)}, \boldsymbol{h}^{(0)}, \boldsymbol{w}_{I/P}^{(0)}$ by WIT/WPT solutions
					\State Obtain splitting ratio $\rho^{(0)}$ and waveform $\boldsymbol{w}_{I/P}^{(0)}$ by GP (Algorithm \ref{al:waveform_split_ratio_gp}) or inner loop (Algorithm \ref{al:inner_loop})
					\Repeat
					\State $i \gets i + 1$
					\State Update IRS phase shift $\boldsymbol{\phi}^{(i)}$ by Algorithm \ref{al:ff_irs}
					\State Update composite channel $\boldsymbol{h}^{(i)}$ by \ref{eq:h_n}
					\State Update splitting ratio $\rho^{(i)}$ and waveform $\boldsymbol{w}_{I/P}^{(i)}$ by GP (Algorithm \ref{al:waveform_split_ratio_gp}) or inner loop (Algorithm \ref{al:inner_loop})
					\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
					\State \textbf{Output} $\boldsymbol{w}_{I/P}^{\star}, \rho^{\star}, R^{\star}, z^{\star}$
				\end{algorithmic}
			\end{algorithm}
		\end{subsubsection}
	\end{subsection}
\end{section}

\bibliographystyle{IEEEtran}
\bibliography{library.bib}
\end{document}
