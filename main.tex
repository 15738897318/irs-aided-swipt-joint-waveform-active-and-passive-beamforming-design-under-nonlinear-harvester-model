\documentclass{IEEEtran}

\input{info.tex}
\input{packages.tex}

\begin{document}

% \input{cover.tex}

\begin{abstract}
	Simultaneous Wireless Information and Power Transfer (SWIPT) is severely restricted by the low power level of the receive Radio-Frequency (RF) signal. To tackle this problem, we introduce Intelligent Reflecting Surface (IRS) that brings a high passive beamforming gain to compensate the propagation loss and boost the energy efficiency with a low power consumption. This paper investigates an IRS-aided multiuser Orthogonal Frequency Division Multiplexing (OFDM) SWIPT system based on practical nonlinear harvester model, where the single-antenna Access Point (AP) transmits information and energy simultaneously to multiple single-antenna users under the assist of IRS. We aim to maximize the weighted sum Rate-Energy (R-E) region via jointly optimizing the phase shifts at the IRS, the transmit waveform at the AP, and the power splitting ratio for all users. The problem is equivalent to a current maximization problems subject to rate constraint, and we propose an low-complexity alternating algorithm to obtain suboptimal solutions iteratively. Numerical results demonstrated that dedicated power signal is beneficial to multicarrier SWIPT, while IRS brings significant R-E region enlargement over benchmark schemes when properly configured.
\end{abstract}

\begin{section}{Introduction}
	\begin{subsection}{Simultaneous Wireless Information and Power Transfer}
		With the great advance in communication performance (throughput, latency, outage), the main challenge of wireless network has come to energy supply. Most existing mobile devices are powered by batteries that require frequent charging or replacement, which leads to high maintenance cost and thus restricts the scale of networks. Although solar energy and inductive coupling has become popular alternatives, the former depends on the environment while the latter has a very short operation range. Simultaneous Wireless Information and Power Transfer (SWIPT) is a promising solution to connect and power mobile devices via electromagnetic (EM) waves in the Radio-Frequency (RF) band. It provides low power (in \si{\uW} level) but broad coverage (up to hundreds of meters) \cite{Ng2018} in a sustainable and controllable manner. The decreasing trend in electronic power consumption also boosts the paradigm shift from dedicated power source to Wireless Power Transfer (WPT) and SWIPT.

		The concept of SWIPT were first cast in \cite{Varshney2008}, where the authors investigated the Rate-Energy (R-E) tradeoff for a flat Gaussian channel and some discrete channels. Two practical receiver structures were then proposed in \cite{Zhou2013}, namely Time Switching (TS) that switches between Energy Harvesting (EH) and Information Decoding (ID) modes, and Power Splitting (PS) that splits the received signal into individual components. On top of this, \cite{Zhang2013} characterized the R-E region for a Multiple-Input Multiple-Output (MIMO) broadcast system under TS and PS setup. Information and power beamforming was then considered in multiuser Multi-Input Single-Output (MISO) systems to maximize the Weighted Sum-Power (WSP) subjective to Signal-to-Interference-plus-Noise Ratio (SINR) constraints \cite{Xu2014}. Motivated by this, \cite{Krikidis2014} investigated fundamental transceiver modules, information and power scheduling, and interference management for SWIPT systems. However, \cite{Boshkovska2015} pointed out that the Radio Frequency-to-Direct Current (RF-to-DC) conversion efficiency depends on the harvester input power level, which also suggested a parametric harvester model based on curve fitting and proposed an iterative resource allocation algorithm. From another perspective, \cite{Trotter2009,Boaventura2011} demonstrated that multisine waveform is more suitable for WPT as it outperforms single tone in both operation range and RF-to-DC efficiency. \cite{Clerckx2016a} derived a tractable nonlinear harvester model based on the Taylor expansion of diode I-V characteristics and proposed an adaptive waveform optimization algorithm to maximize the output DC current under rate constraints. Simulation and experiments demonstrated the benefit of modelling rectifier nonlinearity in system design \cite{Kim2019,Kim2019a}. The work was extended to SWIPT in \cite{Clerckx2018} where a superposition of modulated information waveform and multisine power waveform is optimized to enlarge the R-E region. In contrast, \cite{Park2018} suggested an adaptive dual-mode SWIPT, which alternates between single-tone transmission that exploits conventional modulation for high-rate applications and multisine transmission that encodes the information in the Peak-to-Average Ratio (PAPR) for power-demanding applications. By assuming On-Off-Keying (OOK) where bit 1 carries energy, \cite{Hu2019} compared unary and Run-Length-Limited (RLL) code in terms of rate vs battery overflow/underflow probability, and adapted conventional modulation schemes to ensure WPT is only activated at the points with large offset. Also, a learning approach \cite{Varasteh2019c} demonstrated that the offset of the power symbol is positively correlated to the harvester energy constraint, while the information symbols are symmetrically distributed around the origin. It confirmed that the superposed waveform is feasible to enlarge R-E region when considering rectifier nonlinearity. SWIPT was also explored in the network design. \cite{Liu2016} proposed a cooperative SWIPT Non-Orthogonal Multiple Access (NOMA) protocol with three user selection schemes such that the strong user assists the EH of the weak user. In \cite{Mao2019}, SWIPT based on Rate Splitting (RS) was formulated as a Weighted Sum-Rate (WSR) maximization problem subject to total harvested energy constraint for separated Information Receivers (IRs) and Energy Receivers (ERs).
	\end{subsection}

	\begin{subsection}{Intelligent Reflecting Surface}
		Intelligent Reflecting Surface (IRS) adapts the wireless environment to increase spectrum and energy efficiency. In practice, an IRS consists of multiple individual reflecting elements that adjust the amplitude and phase of the incident signal through passive beamforming. Different from relay and backscatter communication, IRS assists the primary transmission without any active components, leading to low power consumption and no thermal noise added to the reflected signal. Compared with the linear increase in Amplify-and-Forward (AF) relay, the received power scales quadratically with the number of reflectors \cite{Wu2019}, since more reflectors boost the power collected by IRS and increase the array gain in its equal gain transmission.

		Inspired by the advance in real-time reconfigurable metamaterials \cite{Cui2014}, \cite{Liaskos2018} introduced a programmable metasurface that steers or polarizes the EM wave at specific frequency to mitigate signal attenuation. At the same time, \cite{Tan2018} constructed an adjustable reflect array that ensures reliable millimeter-wave (mmWave) communication based on a beam-searching algorithm to reduce indoor signal blockage. Motivated by this, \cite{Wu2018,Wu2019} introduced an IRS-assisted MISO system and proposed a beamforming algorithm that jointly optimizes the precoder at the Access Point (AP) and the phase shifts at the IRS to maximize Signal-to-Noise Ratio (SNR). The active and passive beamforming problem was extended to the discrete phase shift case \cite{Wu2019a} and the multiuser case \cite{Guo2019a}. In \cite{Nadeem2019}, channel estimation for Time-Division Duplex (TDD) systems was carried through a two-stage Minimum Mean Squared Error (MMSE)-based protocol that sequentially estimates the cascaded channel of each IRS element with the others switched off. Starting from the impedance equation, \cite{Abeywickrama2019} investigated the influence of phase shift on the reflection amplitude and proposed a parametric IRS model via curve fitting. Recent research also explored the opportunity of integrating IRS with Orthogonal Frequency-Division Multiplexing (OFDM) systems. \cite{Yang2019} exploited spatial correlation to reduce estimation overhead and design complexity by assuming adjacent elements share a common reflection coefficient. On top of this, group-based OFDM channel estimation was investigated in \cite{Zheng2019}. By adjusting IRS over time slots, \cite{Yang2020} introduced artificial diversity within coherence time and investigated resource allocation and IRS configuration per Resource Block (RB). Real-time high-definition video transmission was performed over a prototype constructed with Positive Intrinsic-Negative (PIN) diodes, which demonstrated the feasibility and benefit of IRS at GHz and mmWave frequency \cite{Dai2020}.

		To the best of authors' knowledge, most existing papers assume a Frequency-Flat (FF) IRS where all elements reflect the signal of different frequency equally. Although Frequency-Selective Surface (FSS) has received much attention for wideband communications, it is different from IRS since active FSS requires RF-chains \cite{Kim2006,Xu2014} while passive FSS has fixed physical characteristics \cite{Anwar2018}.
	\end{subsection}

	\begin{subsection}{IRS-aided SWIPT}
		The effective channel enhancement and low power consumption of IRS are expected to bring more opportunities to SWIPT. Based on linear harvester model and energy interference, \cite{Wu2019b} proved that at most one energy beam is required to maximize the WSP subject to SINR constraints. The fairness issue was then considered in \cite{Tang2019}, which maximize the minimum output power on the assumption of perfect energy interference cancellation. \cite{Wu2019c} proposed a novel penalty-based algorithm, whose inner layer employs Block Coordinate Descent (BCD) method to update precoders, phase shifts and auxiliary variables while the outer layer updates the penalty coefficients. It demonstrated that Line-of-Sight (LoS) links can boost the harvested power, as the rank-deficient channels are highly correlated and a single energy stream can satisfy the energy constraints of all ERs. In \cite{Pan2019a}, the WSR maximization of MIMO SWIPT was first transformed to Weighted Minimum Mean Square Error (WMMSE) problem then solved by BCD with low-complexity iterative algorithms. However, most existing IRS-SWIPT papers focus on narrow-band transmission over linear harvester model.
	\end{subsection}

	\begin{subsection}{Objective and Methodology}
		In this paper, we study an IRS-aided multiuser Single-Input Single-Output (SISO) system where the IRS assists the information and energy transmission of all users. A multicarrier unmodulated power waveform (deterministic multisine) is superposed to a multicarrier modulated information waveform (e.g. OFDM) to boost the energy transfer efficiency with no interference. The transmit waveform, IRS phase shift and receive splitting ratio are jointly optimized to maximize the R-E tradeoff. Different from previous research, this paper investigates the fundamental impact of harvester nonlinearity on waveform and IRS design. We transform the R-E region characterization problem into multiple current maximization problems subject to different rate constraints. To reduce the design complexity, we	propose an Alternating Optimization (AO) algorithm that updates the channel and transceiver iteratively based on Semi-Definite Relaxation (SDR) technique. It was observed that dedicated power waveform boosts the energy transmission efficiency such that TS and PS are preferred for low-rate and high-rate applications respectively. Also, FF-IRS produces a significant channel amplification and R-E enhancement especially when developed near the transmitter, and the performance loss compared with ideal Frequency-Selective (FS) IRS decreases as the number of reflectors increases.
	\end{subsection}
\end{section}

\begin{section}{System Model}
	Consider an IRS-aided multiuser MISO OFDM SWIPT system where the $M$-antenna transmitter delivers information and power simultaneously, through a single $L$-reflector IRS, to $K$ single-antenna users over $N$ orthogonal subbands. We assume a total bandwidth $B$ with evenly-spaced carriers around center frequency $f_c$. Denote the frequency of the $n$-th subband as $f_n$ ($n=1,\dots,N$). Each subband is allocated to one user per time slot. Perfect Channel State Information (CSI) with negligible training overhead is considered to explore the analytical upper-bound of the proposed design. A quasi-static block fading channel model is considered for all links and we focus on one particular block where the channels are approximately unchanged. We characterize and compare the R-E region achieved by TS and PS receivers. Specifically, TS divides each time slot into orthogonal data and energy slots and performs a time sharing between WPT and Wireless Information Transfer (WIT). In comparison, PS splits the received signal into data and energy streams for ID and EH purposes, and the splitting ratio $\rho$ is coupled with waveform and IRS design. Perfect synchronization is assumed among the three parties in both scenarios, and signals reflected by IRS for two and more times are omitted.
	\begin{subsection}{Transmit Signal}
		Denote $\tilde{x}_{I,n}(t)$ as the information symbol transmitted over subband $n$, which belongs to one user at time $t$ and follows a capacity-achieving i.i.d. Circular Symmetric Complex Gaussian (CSCG) distribution $\tilde{x}_{I,n}\sim\mathcal{CN}(0,1)$. Let $\alpha_{k,n}$ be the allocation indicator, namely if subband $n$ is given to user $k$ ($k=1,\dots,K$), we have $\alpha_{k,n}=1$ and $\alpha_{k',n}=0 \ \forall k' \ne k$. Let $\boldsymbol{\alpha}_k=[\alpha_{k,1},\dots,\alpha_{k,N}]^T \in \mathbb{C}^{N \times 1}$. The superposed transmit signal at time $t$ on antenna $m$ ($m=1,\dots,M$) is
		\begin{equation}\label{eq:x_m}
			x_m(t)=\Re\left\{\sum_{n=1}^N\left({w_{I,n,m}\tilde{x}_{I,n}(t)}+w_{P,n,m}\right){e^{j2{\pi}{f_n}{t}}}\right\}
		\end{equation}
		where $w_{I/P,n,m}=s_{I/P,n,m}e^{j\psi_{I/P,n,m}}$ denotes the weight on the information and power signal transmitted by antenna $m$ at subband $n$. We further define $\boldsymbol{w}_{I/P,n}=[w_{I/P,n,1},\dots,w_{I/P,n,M}]^T \in \mathbb{C}^{M \times 1}$ and $\boldsymbol{w}_{I/P}=[\boldsymbol{w}_{I/P,1}^T,\dots,\boldsymbol{w}_{I/P,N}^T]^T \in \mathbb{C}^{MN \times 1}$ such that the transmit information and power signals write as
		\begin{align}
			\boldsymbol{x}_{I}(t) &= \Re{\left\{\sum_{n=1}^N\boldsymbol{w}_{I,n}\tilde{x}_{I,n}(t){e^{j2{\pi}{f_n}{t}}}\right\}}\label{eq:x_I}\\
			\boldsymbol{x}_{P}(t) &= \Re{\left\{\sum_{n=1}^N\boldsymbol{w}_{P,n}{e^{j2{\pi}{f_n}{t}}}\right\}}\label{eq:x_P}
		\end{align}
	\end{subsection}

	\begin{subsection}{Composite Channel}
		At subband $n$, denote the AP-user $k$ direct channel as $\boldsymbol{h}_{D,k,n}^H \in \mathbb{C}^{1 \times M}$, AP-IRS incident channel as $\boldsymbol{H}_{I,n} \in \mathbb{C}^{L \times M}$, and the IRS-user $k$ reflective channel as $\boldsymbol{h}_{R,k,n}^H \in \mathbb{C}^{1 \times L}$. At the IRS, element $l$ ($l=1,\dots,L$) redistributes the incoming signal by adjusting the reflection amplitude $\gamma_l \in [0,1]$ and phase shift $\theta_l \in [0,2\pi)$ \footnote{To investigate the performance upper bound of IRS, we suppose the reflection coefficient is maximized $\gamma_l=1 \ \forall l$ while the phase shift is a continuous variable over $[0,2\pi)$.}. On top of this, the IRS matrix collects the reflection coefficients onto the main diagonal entries as $\boldsymbol{\Theta} = \mathrm{diag}(\gamma_1 e^{j \theta_1}, \dots, \gamma_L e^{j \theta_L}) \in \mathbb{C}^{L \times L}$. The IRS-aided extra link can be modeled as a concatenation of the AP-IRS channel, IRS reflection, and IRS-user channel. Hence, the composite channel for user $k$ over subband $n$ is
		\begin{equation}\label{eq:h_{k,n}}
			\boldsymbol{h}_{k,n}^H = \boldsymbol{h}_{D,k,n}^H + \boldsymbol{h}_{R,k,n}^H \boldsymbol{\Theta} \boldsymbol{H}_{I,n} = \boldsymbol{h}_{D,k,n}^H + \boldsymbol{\phi}^H \boldsymbol{V}_{k,n}
		\end{equation}
		where $\boldsymbol{\phi}=[\gamma_1 e^{j \theta_1}, \dots, \gamma_L e^{j \theta_L}]^H \in \mathbb{C}^{L \times 1}$ and $\boldsymbol{V}_{k,n}=\mathrm{diag}(\boldsymbol{h}_{R,k,n}^H)\boldsymbol{H}_{I,n} \in \mathbb{C}^{L \times M}$. Let $\boldsymbol{h}_k=[\boldsymbol{h}_{k,1}^T,\dots,\boldsymbol{h}_{k,N}^T]^T \in \mathbb{C}^{MN \times 1}$ and $\boldsymbol{V}_k=[\boldsymbol{V}_{k,1}^T,\dots,\boldsymbol{V}_{k,N}^T]^T \in \mathbb{C}^{L \times MN}$. Also, define $\boldsymbol{A}_{k,n}=\lvert \boldsymbol{h}_{k,n} \rvert$ and $\boldsymbol{\varsigma}_{k,n}=\angle{\boldsymbol{h}_{k,n}}$ as the magnitude and phase of the composite channel for user $k$ over subband $n$.
	\end{subsection}

	\begin{subsection}{Receive Signal}
		The information and power signals received by user $k$ through both direct and IRS-aided links write as
		\begin{align}\label{eq:y_{I/P,k}}
			y_{I,k}(t) & = \Re\left\{\sum_{n=1}^N{\boldsymbol{h}_{k,n}^H}{\boldsymbol{w}_{I,n}\tilde{x}_{I,n}(t)}{e^{j2{\pi}{f_n}{t}}}\right\}\\
			y_{P,k}(t) & = \Re\left\{\sum_{n=1}^N{\boldsymbol{h}_{k,n}^H}\boldsymbol{w}_{P,n}{e^{j2{\pi}{f_n}{t}}}\right\}
		\end{align}
	\end{subsection}

	\begin{subsection}{Information Decoder}
		A major benefit of the proposed waveform is that the power component $y_{P,k}(t)$ creates no interference to the information component $y_{I,k}(t)$. Hence, the achievable rate of user $k$ is
		\begin{equation}\label{eq:R_k}
			R_k(\boldsymbol{w}_I,\boldsymbol{\phi},\rho,\boldsymbol{\alpha}_k)=\sum_{n=1}^N\alpha_{k,n}{\log_2\left(1+\frac{(1-\rho)\lvert \boldsymbol{h}_{k,n}\boldsymbol{w}_{I,n} \rvert^2}{\sigma_n^2}\right)}
		\end{equation}
		where $\sigma_n^2$ is the variance of the noise at RF band and during RF-to-BB conversion on tone $n$. Rate \ref{eq:R_k} is achievable with either waveform cancellation or translated demodulation \cite{Clerckx2018b}.
	\end{subsection}

	\begin{subsection}{Energy Harvester}
		Consider a nonlinear diode model based on the Taylor expansion of a small signal model \cite{Clerckx2016a,Clerckx2018b}, which highlights the dependency of harvester output DC current on the received waveform of user $k$ as
		\begin{equation}\label{eq:i_k}
			i_k(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)\approx\sum_{i=0}^{\infty}{k_i'}{\rho^{i/2}}{R_{\text{ant}}^{i/2}}\mathcal{E}\left\{{\mathcal{A}\left\{y_k(t)^i\right\}}\right\}
		\end{equation}
		where $R_{\text{ant}}$ is the impedance of the receive antenna, $k_0'=i_s(e^{-i_kR_{\text{ant}}/nv_t}-1)$, $k_i'=i_se^{-i_kR_{\text{ant}}/nv_t}/i!(nv_t)^i$ for $i=1,\dots,\infty$, $i_s$ is saturation current, $n$ is diode ideality factor, $v_t$ is thermal voltage. For a fixed channel and waveform, $\mathcal{A}\left\{.\right\}$ extracts the DC component of the received signal while $\mathcal{E}\left\{.\right\}$ covers the expectation over $\tilde{x}_{I,n}$.

		With the assumption of evenly spaced frequencies, it holds that $\mathcal{E}\left\{y_k(t)^i\right\}=0$ for odd $i$ and the related terms has no contribution to DC components. For simplicity, we truncate the infinite series to the $n_0$-th order. As proved in \cite{Clerckx2016a}, maximizing a truncated $i_k$ is equivalent to maximizing a monotonic function
		\begin{equation}\label{eq:z_k}
			z_k(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)=\sum_{i\,\text{even},i\ge2}^{n_0}{k_i}{\rho^{i/2}}{R_{\text{ant}}^{i/2}}{\mathcal{E}\left\{\mathcal{A}\left\{y_k(t)^i\right\}\right\}}
		\end{equation}
		where $k_i=i_s/i!(nv_t)^i$. We choose $n_0=4$ to investigate fundamental nonlinearity and let $\beta_2={k_2}{R_{\text{ant}}}$ and $\beta_4={k_4}{R_{\text{ant}}^2}$. Note that $\mathcal{E}\left\{\lvert\tilde{x}_{I,n}\rvert^2\right\}=1$ and $\mathcal{E}\left\{\lvert\tilde{x}_{I,n}\rvert^4\right\}=2$, which can be interpreted as a modulation gain on the nonlinear terms of the output DC current.

		Similar to \cite{Huang2017}, we define $\boldsymbol{W}_{I/P}=\boldsymbol{w}_{I/P}\boldsymbol{w}_{I/P}^H$, $\boldsymbol{H}_k=\boldsymbol{h}_k\boldsymbol{h}_k^H$ and let $\boldsymbol{W}_{I/P,n}$, $\boldsymbol{H}_{k,n}$ keep their $n$-th ($n=-N+1,\dots,N-1$) block diagonal and null the remaining entries, respectively. Due to the positive definiteness of $\boldsymbol{W}_{I/P}$ and $\boldsymbol{H}_k$, we have $\boldsymbol{W}_{I/P,-n}=\boldsymbol{W}_{I/P,n}^H$ and $\boldsymbol{H}_{k,-n}=\boldsymbol{H}_{k,n}^H$. On top of this, the nonzero terms in \ref{eq:z_k} are expressed by \ref{eq:z_k_terms_begin} -- \ref{eq:z_k_terms_end} and $z_k$ reduces to \ref{eq:z_k_expand} -- \ref{eq:z_k_waveform}.
		\begin{figure*}[b]
			\hrule
			\begin{align}
				\mathcal{E}\left\{\mathcal{A}\left\{y_{I,k}^2(t)\right\}\right\}
				& = \frac{1}{2}\sum_n{(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{I,n})(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{I,n})^H}\label{eq:z_k_terms_begin}\\
				& = \frac{1}{2}\boldsymbol{h}_k^H\boldsymbol{W}_{I,0}\boldsymbol{h}_k = \frac{1}{2}\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I\\
				\mathcal{E}\left\{\mathcal{A}\left\{y_{I,k}^4(t)\right\}\right\}
				& = \frac{3}{4}\left(\sum_n{(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{I,n})(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{I,n})^H}\right)^2\\
				& = \frac{3}{4}(\boldsymbol{h}_k^H\boldsymbol{W}_{I,0}\boldsymbol{h}_k)^2 = \frac{3}{4}(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I)^2\\
				\mathcal{A}\left\{y_{P,k}^2(t)\right\}
				& = \frac{1}{2}\sum_n{(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{P,n})(\boldsymbol{h}_{k,n}^H\boldsymbol{w}_{P,n})^H}\\
				& = \frac{1}{2}\boldsymbol{h}_k^H\boldsymbol{W}_{P,0}\boldsymbol{h}_k = \frac{1}{2}\boldsymbol{w}_P^H\boldsymbol{H}_{k,0}\boldsymbol{w}_P\\
				\mathcal{A}\left\{y_{P,k}^4(t)\right\}
				& = \frac{3}{8}\sum_{\substack{{n_1},{n_2},{n_3},{n_4}\\{n_1}+{n_2}={n_3}+{n_4}}}{(\boldsymbol{h}_{k,{n_1}}^H\boldsymbol{w}_{P,{n_1}})(\boldsymbol{h}_{k,{n_2}}^H\boldsymbol{w}_{P,{n_2}})(\boldsymbol{h}_{k,{n_3}}^H\boldsymbol{w}_{P,{n_3}})^H(\boldsymbol{h}_{k,{n_4}}^H\boldsymbol{w}_{P,{n_4}})^H}\\
				& = \frac{3}{8}\sum_{n=-N+1}^{N-1}(\boldsymbol{h}_k^H\boldsymbol{W}_{P,n}^*\boldsymbol{h}_k)(\boldsymbol{h}_k^H\boldsymbol{W}_{P,n}^*\boldsymbol{h}_k)^H = \frac{3}{8}\sum_{n=-N+1}^{N-1}(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}^*\boldsymbol{w}_P)(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}^*\boldsymbol{w}_P)^H\label{eq:z_k_terms_end}
			\end{align}
		\end{figure*}
		\begin{figure*}[b]
			\hrule
			\begin{align}
				z_k(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)
				& = \beta_2\rho\left(\mathcal{E}\left\{\mathcal{A}\left\{y_{I,k}^2(t)\right\}\right\}+\mathcal{A}\left\{y_{P,k}^2(t)\right\}\right)+\beta_4\rho^2\left(\mathcal{E}\left\{\mathcal{A}\left\{y_{I,k}^4(t)\right\}\right\}+\mathcal{A}\left\{y_{P,k}^4(t)\right\}+6\mathcal{E}\left\{\mathcal{A}\left\{y_{I,k}^2(t)\right\}\right\}\mathcal{A}\left\{y_{P,k}^2(t)\right\}\right)\label{eq:z_k_expand}\\
				& = \frac{1}{2}\beta_2\rho(\boldsymbol{h}_k^H\boldsymbol{W}_{I,0}\boldsymbol{h}_k+\boldsymbol{h}_k^H\boldsymbol{W}_{P,0}\boldsymbol{h}_k)\nonumber\\
				& \quad+ \frac{3}{8}\beta_4\rho^2 \left(2(\boldsymbol{h}_k^H\boldsymbol{W}_{I,0}\boldsymbol{h}_k)^2 + \sum_{n=-N+1}^{N-1} (\boldsymbol{h}_k^H\boldsymbol{W}_{P,n}^*\boldsymbol{h}_k)(\boldsymbol{h}_k^H\boldsymbol{W}_{P,n}^*\boldsymbol{h}_k)^H\right)\nonumber\\
				& \quad+ \frac{3}{2}\beta_4\rho^2(\boldsymbol{h}_k^H\boldsymbol{W}_{I,0}\boldsymbol{h}_k)(\boldsymbol{h}_k^H\boldsymbol{W}_{P,0}\boldsymbol{h}_k)\label{eq:z_k_channel}\\
				& = \frac{1}{2}\beta_2\rho(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I+\boldsymbol{w}_P^H\boldsymbol{H}_{k,0}\boldsymbol{w}_P)\nonumber\\
				& \quad+ \frac{3}{8}\beta_4\rho^2 \left(2(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I)^2 + \sum_{n=-N+1}^{N-1}(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}^*\boldsymbol{w}_P)(\boldsymbol{w}_P^H\boldsymbol{H}_{k,n}^*\boldsymbol{w}_P)^H \right)\nonumber\\
				& \quad+ \frac{3}{2}\beta_4\rho^2(\boldsymbol{w}_I^H\boldsymbol{H}_{k,0}\boldsymbol{w}_I)(\boldsymbol{w}_P^H\boldsymbol{H}_{k,0}\boldsymbol{w}_P)\label{eq:z_k_waveform}
			\end{align}
		\end{figure*}
	\end{subsection}

	\begin{subsection}{Weighted Sum Rate-Energy Region}
		Define the achievable weighted sum R-E region as
		\begin{equation}
			\begin{split}
				C_{R-I}(P)
				&\triangleq \biggl\{(R,Z):R\le\sum_{k=1}^K{u_{I,k}R_k},Z\le\sum_{k=1}^K u_{P,k}z_k,\\
				&\quad \frac{1}{2}({\boldsymbol{w}_I^H}{\boldsymbol{w}_I}+{\boldsymbol{w}_P^H}{\boldsymbol{w}_P}) \le P\biggr\}
			\end{split}
		\end{equation}
		where $P$ is the transmit power budget and $u_{I,k},u_{P,k}$ are the information and power weight of user $k$.
	\end{subsection}
\end{section}

\begin{section}{Single-User Optimization}
	Consider a single-user waveform and IRS optimization problem where $\boldsymbol{\alpha}=\boldsymbol{1}^{N \times 1}$. We characterize the rate-energy region through a current maximization problem subject to transmit power, rate, and IRS constraints
	\begin{maxi!}
		{\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho}{z(\boldsymbol{w}_I,\boldsymbol{w}_P,\boldsymbol{\phi},\rho)}{\label{op:su}}{\label{eq:su_target}}
		\addConstraint{\frac{1}{2}({\boldsymbol{w}_I^H}{\boldsymbol{w}_I}+{\boldsymbol{w}_P^H}{\boldsymbol{w}_P})\le{P}}
		\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\lvert(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\boldsymbol{w}_{I,n}\rvert^2}{\sigma_n^2}\right)} \ge \bar{R}}\label{eq:su_rate_constraint}
		\addConstraint{\lvert{\phi_l}\rvert=1, \quad l=1,\dots,L}
		\addConstraint{0 \le \rho \le 1}
	\end{maxi!}
	Problem \ref{op:su} is intricate due to the non-convex objective function \ref{eq:su_target} and constraint \ref{eq:su_rate_constraint} with coupled variables. To reduce the design complexity, we propose an suboptimal AO algorithm that updates the IRS phase shift, transmit waveform, and receive splitting ratio iteratively.

	\begin{subsection}{IRS Phase Shift}
		\begin{subsubsection}{Frequency-Selective IRS}\label{se:fs_irs}
			In the ideal case, each element in FS-IRS is expected to provide subband-dependent reflection coefficients. Hence, $\boldsymbol{\phi}_n$ replaces $\boldsymbol{\phi}$ in \ref{op:su} and the IRS has a total Degree of Freedom (DoF) of $NL$. Note that $\lvert{(h_{D,n}+\boldsymbol{v}_n^H\boldsymbol{\phi}_n)w_{I,n}}\rvert \le \lvert{h_{D,n}w_{I,n}}\rvert+\lvert{\boldsymbol{v}_n^H\boldsymbol{\phi}_n w_{I,n}}\rvert$ where the equality holds when the direct and IRS-aided links are aligned. Therefore, we simply select the phase shift of element $l$ at subband $n$ as
			\begin{equation}\label{eq:theta}
				\theta_{n,l}^\star = \angle{h}_{D,n} - \angle{h_{R,n,l}}-\angle{h_{I,n,l}}
			\end{equation}
			That is to say, the optimal phase shift is obtained in closed form in the single-user scenario, which ensures the direct, extra and composite channels have the same phase.
		\end{subsubsection}

		\begin{subsubsection}{Frequency-Flat IRS}
			In contrast, FF-IRS reflects all subbands equally with a DoF of $L$. We observe that
			\begin{equation}\label{eq:h_n_outer_product}
				\begin{split}
					\boldsymbol{h}_n\boldsymbol{h}_n^H
					&=(\boldsymbol{h}_{D,n}+\boldsymbol{V}_n^H\boldsymbol{\phi})(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\\
					&=\boldsymbol{h}_{D,n}\boldsymbol{h}_{D,n}^H+\boldsymbol{V}_n^H\boldsymbol{\phi}\boldsymbol{h}_{D,n}^H+\boldsymbol{h}_{D,n}\boldsymbol{\phi}^H\boldsymbol{V}_n+\boldsymbol{V}_n^H\boldsymbol{\phi}\boldsymbol{\phi}^H\boldsymbol{V}_n\\
					&=\boldsymbol{M}_n^H\boldsymbol{\Phi}\boldsymbol{M}_n
				\end{split}
			\end{equation}
			where $t$ is an auxiliary variable with unit modulus and
			\begin{equation}\label{eq:M_n,phi}
				\boldsymbol{M}_n=
				\begin{bmatrix}
					\boldsymbol{V}_n \\
					\boldsymbol{h}_{D,n}^H
				\end{bmatrix} \in \mathbb{C}^{(L+1) \times M},
				\quad \bar{\boldsymbol{\phi}}=\
				\begin{bmatrix}
					\boldsymbol{\phi} \\
					t
				\end{bmatrix},
				\quad \boldsymbol{\Phi}=\bar{\boldsymbol{\phi}}\bar{\boldsymbol{\phi}}^H
			\end{equation}
			Therefore, it holds that
			\begin{equation}
				\begin{split}
					\lvert(\boldsymbol{h}_{D,n}^H+\boldsymbol{\phi}^H\boldsymbol{V}_n)\boldsymbol{w}_{I,n}\rvert^2
					&=\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H\boldsymbol{\Phi}\boldsymbol{M}_n\boldsymbol{w}_{I,n}\\
					&=\mathrm{Tr}(\boldsymbol{M}_n\boldsymbol{w}_{I,n}\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H\boldsymbol{\Phi})\\
					&=\mathrm{Tr}(\boldsymbol{C}_n\boldsymbol{\Phi})
				\end{split}
			\end{equation}
			with $\boldsymbol{C}_n = \boldsymbol{M}_n\boldsymbol{w}_{I,n}\boldsymbol{w}_{I,n}^H\boldsymbol{M}_n^H \in \mathbb{C}^{(L+1)\times(L+1)}$. Similarly, we have
			\begin{equation}
				\boldsymbol{h}\boldsymbol{h}^H=\boldsymbol{M}^H\boldsymbol{\Phi}\boldsymbol{M}
			\end{equation}
			where
			\begin{equation}\label{eq:M}
				\boldsymbol{M}=
				\begin{bmatrix}
					\boldsymbol{V} \\
					\boldsymbol{h}_D^H
				\end{bmatrix} \in \mathbb{C}^{(L+1) \times MN}
			\end{equation}
			We then introduce auxiliary variables
			\begin{equation}\label{eq:t}
				\begin{split}
					t_{I/P,n}
					&=\boldsymbol{h}^H\boldsymbol{W}_{I/P,n}^*\boldsymbol{h}\\
					&=\mathrm{Tr}(\boldsymbol{h}\boldsymbol{h}^H\boldsymbol{W}_{I/P,n}^*)\\
					&=\mathrm{Tr}(\boldsymbol{M}^H\boldsymbol{\Phi}\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*)\\
					&=\mathrm{Tr}(\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*\boldsymbol{M}^H\boldsymbol{\Phi})\\
					&=\mathrm{Tr}(\boldsymbol{C}_{I/P,n}\boldsymbol{\Phi})
				\end{split}
			\end{equation}
			with $\boldsymbol{C}_{I/P,n}=\boldsymbol{M}\boldsymbol{W}_{I/P,n}^*\boldsymbol{M}^H \in \mathbb{C}^{(L+1)\times(L+1)}$. Therefore, \ref{eq:z_k_channel} rewrites as
			\begin{equation}\label{eq:z_irs}
				\begin{split}
					z(\boldsymbol{\Phi})
					&=\frac{1}{2}{\beta_2}{\rho}(t_{I,0}+t_{P,0})\\
					&\quad+\frac{3}{8}{\beta_4}{\rho^2} \left(2t_{I,0}^2 + \sum_{n=-N+1}^{N-1}{t_{P,n}t_{P,n}^*}\right)\\
					&\quad+\frac{3}{2}{\beta_4}{\rho^2}t_{I,0}t_{P,0}
				\end{split}
			\end{equation}
			We use first-order Taylor expansion to approximate the second-order terms in \ref{eq:z_irs}. Based on the variables optimized at iteration $i - 1$, the local approximation at iteration $i$ suggests \cite{Adali2010}
			\begin{align}
				(t_{I,0}^{(i)})^2
				& \ge 2 t_{I,0}^{(i)}t_{I,0}^{(i-1)} - (t_{I,0}^{(i-1)})^2\label{eq:t_{I,0}_square}\\
				t_{P,n}^{(i)} (t_{P,n}^{(i)})^*
				& \ge 2 \Re\left\{t_{P,n}^{(i)} (t_{P,n}^{(i-1)})^*\right\} - t_{P,n}^{(i-1)} (t_{P,n}^{(i-1)})^*\\
				t_{I,0}^{(i)} t_{P,0}^{(i)}
				& = \frac{1}{4}(t_{I,0}^{(i)} + t_{P,0}^{(i)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\nonumber\\
				& \ge \frac{1}{2}(t_{I,0}^{(i)} + t_{P,0}^{(i)})(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})\nonumber\\
				& \quad - \frac{1}{4}(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\label{eq:t_{I/P,0}}
			\end{align}
			\ref{eq:t_{I,0}_square} -- \ref{eq:t_{I/P,0}} provide lower bounds to the corresponding terms in \ref{eq:z_irs}, and the approximated current function at iteration $i$ is given in \ref{eq:z_irs_approx}.
			\begin{figure*}[b]
				\hrule
				\begin{equation}\label{eq:z_irs_approx}
					\begin{split}
						\tilde{z}(\boldsymbol{\Phi}^{(i)})
						& = \frac{1}{2}{\beta_2}{\rho}(t_{I,0}^{(i)}+t_{P,0}^{(i)})\\
						& \quad + \frac{3}{8}{\beta_4}{\rho^2} \left(4 (t_{I,0}^{(i)})(t_{I,0}^{(i-1)}) - 2 (t_{I,0}^{(i-1)})^2 + \sum_{n=-N+1}^{N-1}{2 \Re\left\{t_{P,n}^{(i)} (t_{P,n}^{(i-1)})^*\right\} - t_{P,n}^{(i-1)} (t_{P,n}^{(i-1)})^*}\right)\\
						& \quad + \frac{3}{2}{\beta_4}{\rho^2} \left(\frac{1}{2}(t_{I,0}^{(i)} + t_{P,0}^{(i)})(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)}) - \frac{1}{4}(t_{I,0}^{(i-1)} + t_{P,0}^{(i-1)})^2 - \frac{1}{4}(t_{I,0}^{(i)} - t_{P,0}^{(i)})^2\right)
					\end{split}
				\end{equation}
			\end{figure*}
			Hence, problem \ref{op:su} is transformed to
			\begin{maxi!}
				{\boldsymbol{\boldsymbol{\Phi}}}{\tilde{z}(\boldsymbol{\Phi})}{\label{op:su_irs}}{\label{eq:su_irs_target}}
				\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\lvert{w}_{I,n}\rvert^2\mathrm{Tr}(\boldsymbol{R}_n\boldsymbol{\Phi})}{\sigma_n^2}\right)} \ge \bar{R}}
				\addConstraint{\boldsymbol{\Phi}_{l,l}=1, \quad l=1,\dots,L+1}
				\addConstraint{\boldsymbol{\Phi}\succeq{0}}
				\addConstraint{\mathrm{rank}(\boldsymbol{\Phi})=1\label{co:irs_rank}}
			\end{maxi!}
			We then relax the rank constraint \ref{co:irs_rank} and solve the optimal IRS matrix $\boldsymbol{\Phi}^{\star}$ iteratively by interior-point method. If $\mathrm{rank}(\boldsymbol{\Phi}^{\star})=1$, the optimal phase shift vector $\bar{\boldsymbol{\phi}}^\star$ is attained by eigenvalue decomposition (EVD). Otherwise, a best feasible candidate $\bar{\boldsymbol{\phi}}^\star$ can be extracted through Gaussian randomization method \cite{Huang2010}. We first perform EVD on $\boldsymbol{\Phi}^{\star}$ as $\boldsymbol{\Phi}^{\star}=\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}^H$. Then, we generate $Q$ CSCG random vectors $\boldsymbol{r}_q \sim \mathcal{CN}(\boldsymbol{0},\boldsymbol{I}_{L+1}),\ q=1,\dots,Q$ and construct the corresponding candidates $\bar{\boldsymbol{\phi}}_q=e^{j\arg\left(\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q\right)}$. Next, the optimal solution $\bar{\boldsymbol{\phi}}^\star$ is approximated by the one maximizes the objective function \ref{eq:su_irs_target}. Finally, we can retrieve the phase shift by $\theta_l=\arg(\phi_l^\star/\phi_{L+1}^\star), \ l=1,\dots,L$. The algorithm for the phase shift optimization subproblem is summarized in Algorithm \ref{al:ff_irs}.
			\begin{algorithm}
				\caption{FF-IRS: Phase Shift}
				\label{al:ff_irs}
				\begin{algorithmic}[1]
					\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,Q,\bar{R},\epsilon,\rho,\boldsymbol{w}_{I/P},\sigma_n \ \forall n$
					\State \textbf{Initialize} $i \gets 0,\boldsymbol{\Phi}^{(0)},t_{I/P,n}^{(0)}\ \forall n$ by \ref{eq:t}
					\State Construct $\boldsymbol{M},\boldsymbol{R}_n,\boldsymbol{C}_{I/P,n} \ \forall n$ by \ref{eq:M}, \ref{eq:R_n,phi}, \ref{eq:C_{I/P,n}}
					\Repeat
					\State $i \gets i + 1$
					\State Obtain IRS matrix $\boldsymbol{\Phi}^{(i)}$ by solving problem \ref{op:su_irs}
					\State Update auxiliary $t_{I/P,n}^{(i)} \forall n$ by \ref{eq:t} for SCA
					\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
					\State Perform EVD $\boldsymbol{\Phi}^{\star}=\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}^H$
					\State Generate CSCG random vectors $\boldsymbol{r}_q \sim \mathcal{CN}(\boldsymbol{0},\boldsymbol{I}_{L+1}) \ \forall q$
					\State Construct candidate IRS vectors $\bar{\boldsymbol{\phi}}_q=e^{j\arg\left(\boldsymbol{U}_{\boldsymbol{\Phi}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q\right)}$ and matrices $\boldsymbol{\Phi}_q=\bar{\boldsymbol{\phi}}_q\bar{\boldsymbol{\phi}}_q^H  \ \forall q$
					\State Select the best solution $\boldsymbol{\Phi}^\star$ and $\boldsymbol{\phi}^\star$ for problem \ref{op:su_irs}
					\State Compute phase shift by $\theta_l^\star=\arg(\phi_l^\star/\phi_{L+1}^\star), \ l=1,\dots,L$
					\State \textbf{Output} $\theta_l^\star \ \forall l$
				\end{algorithmic}
			\end{algorithm}
		\end{subsubsection}
	\end{subsection}

	\begin{subsection}{Waveform and Splitting Ratio}
		\begin{subsubsection}{Geometric Programming}
			Following \cite{Clerckx2018b}, it can be observed from \ref{eq:R_k} and \ref{eq:z_k_expand} -- \ref{eq:z_k_waveform} that the optimal phases of information and power waveform are both match to the composite channel as
			\begin{equation}\label{eq:psi}
				\psi_{I,n}^{\star}=\psi_{P,n}^{\star}=-\bar{\psi}_{n}
			\end{equation}
			By such a phase selection, we have
			\begin{equation}
				\lvert{(h_{D,n}+\boldsymbol{v}_n^H\boldsymbol{\phi}_n)w_{I,n}}\rvert = \lvert h_{D,n} \rvert \lvert w_{I,n} \rvert + \vert \boldsymbol{v}_n^H\boldsymbol{\phi}_n \rvert \lvert w_{I,n} \rvert
			\end{equation}
			Also, denote the waveform amplitude at subband $n$ as
			\begin{equation}\label{eq:s}
				s_{I/P,n} = \lvert w_{I/P,n} \rvert
			\end{equation}
			which is further collected into $\boldsymbol{s}_{I/P} \in \mathbb{C}^{N \times 1}$. Therefore, the original problem \ref{op:su} is reduced to an amplitude optimization problem
			\begin{maxi!}
					{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho}{z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}{\label{op:su_gp}}{}
					\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P})\le{P}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho){A_n^2}{s_{I,n}^2}}{\sigma_n^2}\right)} \ge \bar{R}}
				\end{maxi!}
			\begin{figure*}[b]
				\hrule
				\begin{equation}\label{eq:z_gp}
					\begin{split}
						z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)
						&=\frac{1}{2}{\beta_2}{\rho}\sum_n{A_n^2(s_{I,n}^2+s_{P,n}^2)}\\
						&\quad+\frac{3}{8}{\beta_4}{\rho^2} \left(\left(\sum_{n}(A_n s_{I,n})^2\right)^2 + \sum_{\substack{{n_1},{n_2},{n_3},{n_4}\\{n_1}+{n_2}={n_3}+{n_4}}}{A_{n_1}A_{n_2}A_{n_3}A_{n_4}(s_{P,n_1}s_{P,n_2}s_{P,n_3}s_{P,n_4})}\right)\\
						&\quad+\frac{3}{2}{\beta_4}{\rho^2}\sum_n{{A_n^4}{s_{I,n}^2}{s_{P,n}^2}}
					\end{split}
				\end{equation}
			\end{figure*}
			with $z$ given by \ref{eq:z_gp}. We introduce an auxiliary variable $t''$ and transform problem \ref{op:su_gp} into
			\begin{mini!}
					{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho,t''}{\frac{1}{t''}}{\label{op:su_gp_1}}{}
					\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P}) \le P}
					\addConstraint{\frac{t''}{z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)} \le 1}
					\addConstraint{\frac{2^{\bar{R}}}{\prod_n \left(1+\frac{(1-\rho){A_n^2}{s_{I,n}^2}}{\sigma_n^2}\right)} \le 1}
				\end{mini!}
			Problem \ref{op:su_gp_1} can be transformed to standard GP by first decomposing the information and power posynomials as sum of monomials, then deriving their upper bounds using Arithmetic Mean-Geometric Mean (AM-GM) inequality \cite{Clerckx2018b,Chiang2005}. Let $z(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)=\sum_{m=1}^{M}{g_{P,m}(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}$, problem \ref{op:su_gp_1} is equivalent to
			\begin{mini}
				{\boldsymbol{s}_I,\boldsymbol{s}_P,\rho,\bar{\rho},t''}{\frac{1}{t''}}{\label{op:su_gp_2}}{}
				\addConstraint{\frac{1}{2}({\boldsymbol{s}_I^H}{\boldsymbol{s}_I}+{\boldsymbol{s}_P^H}{\boldsymbol{s}_P})\le{P}}
				\addConstraint{{t''}\prod_m{\left(\frac{g_{P,m}(\boldsymbol{s}_I,\boldsymbol{s}_P,\rho)}{\gamma_{P,m}}\right)^{-\gamma_{P,m}}}\le{1}}
				\addConstraint{2^{\bar{R}}\prod_{n}{\left(\frac{1}{\gamma_{I,n,1}}\right)^{-\gamma_{I,n,1}} \left(\frac{\bar{\rho}{A_n^2}{s_{I,n}^2}}{{\sigma_n^2}{\gamma_{I,n,2}}}\right)^{-\gamma_{I,n,2}}}\le{1}}
				\addConstraint{\rho + \bar{\rho} \le 1}
			\end{mini}
			where $\gamma_{I,n,1},\gamma_{I,n,2} \ge 0$, $\gamma_{I,n,1}+\gamma_{I,n,2}=1$, $\gamma_{P,m} \ge 0 \ \forall m$, and $\sum_{m=1}^{M}{\gamma_m}=1$. The tightness of the AM-GM inequality depends on $\{\gamma_{I,n},\gamma_P\}$ that require successive update. At iteration $i$, we choose \cite{Clerckx2018b}
			\begin{align}
				\gamma_{I,n,1}^{(i)} & = \left. 1 \middle/ \left(1+\frac{\bar{\rho}^{(i-1)}{A_n^2}(s_{I,n}^{(i-1)})^2}{\sigma_n^2}\right) \right.\label{eq:gamma_I_1}\\
				\gamma_{I,n,2}^{(i)} & = 1 - \gamma_{I,n,1}^{(i)}\label{eq:gamma_I_2}\\
				\gamma_{P,m}^{(i)} & =\frac{g_{P,m}(\boldsymbol{s}_I^{(i-1)},\boldsymbol{s}_P^{(i-1)},\rho^{(i-1)})}{z(\boldsymbol{s}_I^{(i-1)},\boldsymbol{s}_P^{(i-1)},\rho^{(i-1)})}\label{eq:gamma_P}
			\end{align}
			and then solve problem \ref{op:su_gp_2}. The GP algorithm is summarized in Algorithm \ref{al:waveform_split_ratio_gp}.
			\begin{algorithm}
				\caption{GP: Waveform and Splitting Ratio}
				\label{al:waveform_split_ratio_gp}
				\begin{algorithmic}[1]
					\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h},P,\bar{R},\epsilon,\sigma_n \ \forall n$
					\State \textbf{Initialize} $i \gets 0$, $\boldsymbol{s}_{I/P}^{(0)}$, $\rho^{(0)}$
					\State Retrieve channel amplitude response $A_n \ \forall n$ by \ref{eq:h_{k,n}}
					\Repeat
					\State $i \gets i + 1$
					\State Update GM exponents $\{\gamma_{I,n}^{(i)},\gamma_{P}^{(i)}\}$ by \ref{eq:gamma_I_1} -- \ref{eq:gamma_P}
					\State Obtain waveform amplitude $\boldsymbol{s}_{I/P}^{(i)}$ and power splitting ratio $\rho^{(i)}$ by solving problem \ref{op:su_gp_2}
					\State Compute output DC current $z^{(i)}$ by \ref{eq:z_gp}
					\Until $\lvert (z^{(i)} - z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
					\State Recover waveform $\boldsymbol{w}_{I/P}^{\star}$ by \ref{eq:psi} and \ref{eq:s}
					\State \textbf{Output} $\boldsymbol{w}_{I/P}^{\star}, \rho^{\star}$
				\end{algorithmic}
			\end{algorithm}
		\end{subsubsection}

		\begin{subsubsection}{Semi-Definite Relaxation}
			In this case, waveform and splitting ratio are updated iteratively until convergence.
			\begin{paragraph}{Transmit Waveform}
				Consider the waveform optimization subproblem. Once $\boldsymbol{\phi}$ and $\rho$ are obtained, introduce auxiliary variables
				\begin{equation}\label{eq:t'}
					t_{I/P,n}' = \boldsymbol{w}_{I/P}^H \boldsymbol{H}_n^* \boldsymbol{w}_{I/P} = \mathrm{Tr}(\boldsymbol{H}_n^*\boldsymbol{W}_{I/P})
				\end{equation}
				Therefore, \ref{eq:z_k_waveform} rewrites as
				\begin{equation}\label{eq:z_waveform}
					\begin{split}
						z(\boldsymbol{W}_I,\boldsymbol{W}_P)
						&=\frac{1}{2} \beta_2 \rho (t'_{I,0}+t'_{P,0})\\
						&\quad+\frac{3}{8} \beta_4 \rho^2 \left(2(t'_{I,0})^2 + \sum_{n=-N+1}^{N-1}{t'_{P,n}(t'_{P,n})^*}\right)\\
						&\quad+\frac{3}{2} \beta_4 \rho^2 t'_{I,0}t'_{P,0}
					\end{split}
				\end{equation}
				Since \ref{eq:z_waveform} and \ref{eq:z_irs} are in the same form, we reuse \ref{eq:t_{I,0}_square} -- \ref{eq:t_{I/P,0}} and bound \ref{eq:z_waveform} by replacing $t_{I/P,n}$ with $t_{I/P,n}'$ in \ref{eq:z_irs_approx}. Hence, problem \ref{op:su} is transformed to
				\begin{maxi!}
					{\boldsymbol{W}_I,\boldsymbol{W}_P}{\tilde{z}(\boldsymbol{W}_I,\boldsymbol{W}_P)}{\label{op:su_waveform}}{\label{eq:su_waveform_target}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)W_{I,n,n}\lvert h_n \rvert^2}{\sigma_n^2}\right)} \ge \bar{R}\label{eq:su_waveform_constraint}}
					\addConstraint{\frac{1}{2}\left(\mathrm{Tr}(\boldsymbol{W}_I)+\mathrm{Tr}(\boldsymbol{W}_P)\right) \le P}
					\addConstraint{\boldsymbol{W}_{I/P} \succeq 0}
					\addConstraint{\mathrm{rank}(\boldsymbol{W}_{I/P})=1\label{co:waveform_rank}}
				\end{maxi!}
				We then perform SDR and solve the optimal waveform matrix $\boldsymbol{W}_{I/P}^{\star}$ iteratively by interior-point method. $\boldsymbol{w}_I^{\star}$ and $\boldsymbol{w}_P^{\star}$ can also be extracted using randomized vectors $\boldsymbol{r}_q \in \mathbb{C}^{(L+1) \times 1}$, whose entries are uniformly distributed on the unit circle $r_{q,n}=e^{j\xi_{q,n}}, \ \xi_{q,n} \sim \mathcal{U}[0,2\pi) \ \forall q, n$. The algorithm is summarized in Algorithm \ref{al:waveform_sdr}.
				\begin{algorithm}
					\caption{SDR: Transmit Waveform}
					\label{al:waveform_sdr}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,P,Q,\bar{R},\epsilon,\rho,\sigma_n \ \forall n$
						\State \textbf{Initialize} $i \gets 0$, $\boldsymbol{W}_{I/P}^{(0)}$, $t_{I/P,n}^{\prime (0)} \ \forall n$ by \ref{eq:t'}
						\State Construct $\boldsymbol{H}_n,\boldsymbol{R}_n \ \forall n$ by \ref{eq:R_n,phi}
						\Repeat
						\State $i \gets i + 1$
						\State Obtain waveform matrices $\boldsymbol{W}_{I/P}^{(i)}$ by solving problem \ref{op:su_waveform}
						\State Update auxiliary $t_{I/P,n}^{\prime (i)} \forall n$ by \ref{eq:t'} for SCA
						\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
						\State Perform EVD $\boldsymbol{W}_{I/P}^{\star}=\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}^H$
						\State Generate random vectors $\boldsymbol{r}_q \ \forall q$ with entries uniformly distributed on the unit circle
						\State Construct candidate waveform vectors $\boldsymbol{w}_{I/P,r}=\boldsymbol{U}_{\boldsymbol{W}_{I/P}^{\star}}\boldsymbol{\Sigma}_{\boldsymbol{W}_{I/P}^{\star}}^{\frac{1}{2}}\boldsymbol{r}_q$ and matrices $\boldsymbol{W}_{I/P,q}=\boldsymbol{w}_{I/P,q}\boldsymbol{w}_{I/P,q}^H  \ \forall q$
						\State Select the best solution $\boldsymbol{W}_{I/P}^\star$ and $\boldsymbol{w}_{I/P}^\star$ for problem \ref{op:su_waveform}
						\State \textbf{Output} $\boldsymbol{w}_{I/P}^\star$
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}

			\begin{paragraph}{Receive Splitting Ratio}
				We then optimize the power splitting ratio $\rho$ for any fixed phase shift $\boldsymbol{\phi}$ and waveform $\boldsymbol{w}_{I/P}$. In this case, the output DC current is also expressed in \ref{eq:z_waveform} but as a function of $\rho$ with constant $t_{I/P,n}'$ given by \ref{eq:t'}. Since $z(\rho)$ is a quadratic function that monotonically increases over $\rho \in [0, 1]$, we replace the convex objective function $z(\rho)$ with affine $\rho$ and transform problem \ref{op:su} to
				\begin{maxi!}
					{\rho}{\rho}{\label{op:su_ratio}}{\label{eq:su_ratio_target}}
					\addConstraint{\sum_{n}{\log_2\left(1+\frac{(1-\rho)\lvert h_n w_n \rvert^2}{\sigma_n^2}\right)} \ge \bar{R}\label{eq:su_ratio_constraint}}
					\addConstraint{0 \le \rho \le 1}
				\end{maxi!}
				The optimal power splitting ratio $\rho^\star$ can be obtained by solving problem \ref{op:su_ratio}.
			\end{paragraph}

			\begin{paragraph}{Inner Loop}
				As summarized in Algorithm \ref{al:inner_loop}, the inner loop updates the waveform and splitting ratio iteratively until convergence.
				\begin{algorithm}
					\caption{Inner Loop: Waveform and Splitting Ratio}
					\label{al:inner_loop}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D,\boldsymbol{h}_I,\boldsymbol{h}_R,P,Q,\bar{R},\epsilon,\rho,\sigma_n \ \forall n$
						\State \textbf{Initialize} $\boldsymbol{w}_{I/P}^{(0)}$
						\State $i \gets 0$
						\Repeat
						\State $i \gets i + 1$
						\State Update splitting ratio $\rho^{(i)}$ by solving problem \ref{op:su_ratio}
						\State Update waveform $\boldsymbol{w}_{I/P}^{(i)}$ by Algorithm \ref{al:waveform_sdr}
						\Until $\lvert (z^{(i)}-z^{(i-1)}) / z^{(i)} \rvert \le \epsilon$
						\State \textbf{Output} $\boldsymbol{w}_{I/P}^{\star}, \rho^{\star}$
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}
		\end{subsubsection}
	\end{subsection}

	\begin{subsection}{R-E Region Characterization}
		\begin{subsubsection}{WIT Initialization}
			To characterize the R-E region, we initialize the algorithm to WIT mode ($\rho = 0$) and reduce the rate constraint gradually to obtain the boundary points.
			\begin{paragraph}{FS-IRS}
				As discussed in Section \ref{se:fs_irs}, the optimal FS-IRS and composite channel are obtained in closed form. We use water-filling algorithm to obtain the best power allocation $p_n^\star=\lvert w_{I,n} \rvert^2$ and combine with the waveform phase selection in \ref{eq:psi}. Hence, the optimal information waveform at subband $n$ is
				\begin{equation}\label{eq:w_{I,n}}
					w_{I,n}^\star=\sqrt{p_n^\star}e^{j \psi_{I,n}^\star}
				\end{equation}
			\end{paragraph}
			\begin{paragraph}{FF-IRS}
				Consider a rate maximization problem with given information waveform $\boldsymbol{w}_I$ as
				\begin{maxi!}
					{\boldsymbol{\Phi}}{\sum_{n}{\log_2\left(1+\frac{\lvert{w}_{I,n}\rvert^2\mathrm{Tr}(\boldsymbol{R}_n\boldsymbol{\Phi})}{\sigma_n^2}\right)}}{\label{op:su_irs_wit}}{}
					\addConstraint{\boldsymbol{\Phi}_{l,l}=1, \quad l=1,\dots,L+1}
					\addConstraint{\boldsymbol{\Phi}\succeq{0}}
					\addConstraint{\mathrm{rank}(\boldsymbol{\Phi})=1}
				\end{maxi!}
				Problem \ref{op:su_irs_wit} can be solved after SDR, and a best solution $\bar{\boldsymbol{\phi}}^\star$ can be obtained via Gaussian randomization method. $\boldsymbol{\phi}^\star$ can be recovered by $\phi_l^\star=\phi_l^\star/\phi_{L+1}^\star, \ l=1,\dots,L$. We then construct composite channel $\boldsymbol{h}$ by \ref{eq:h_k} and obtain the optimal information waveform from \ref{eq:w_{I,n}}. FF-IRS and information waveform are updated iteratively until convergence. The WIT algorithm for FF-IRS is summarized in Algorithm \ref{al:ff_wit}.
				\begin{algorithm}
					\caption{FF-IRS: WIT Initialization}
					\label{al:ff_wit}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\boldsymbol{h}_D, \boldsymbol{h}_I, \boldsymbol{h}_R, P, Q, \epsilon, \sigma_n$
						\State \textbf{Initialize} $i \gets 0$, $\boldsymbol{\phi}^{(0)},\boldsymbol{w}_I^{(0)}$
						\State Construct $\boldsymbol{R}_n \ \forall n$ by \ref{eq:R_n,phi}
						\Repeat
						\State $i \gets i + 1$
						\State Obtain IRS matrix $\boldsymbol{\Phi}^{(i)}$ by solving problem \ref{op:su_irs_wit}
						\State Perform EVD $\boldsymbol{\Phi}^{(i)}=\boldsymbol{U}_{\boldsymbol{\Phi}^{(i)}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{(i)}}\boldsymbol{U}_{\boldsymbol{\Phi}^{(i)}}^H$
						\State Generate CSCG random vectors $\boldsymbol{r}_q \sim \mathcal{CN}(\boldsymbol{0},\boldsymbol{I}_{L+1}) \ \forall q$
						\State Construct candidate IRS vectors $\bar{\boldsymbol{\phi}}_q=e^{j\arg\left(\boldsymbol{U}_{\boldsymbol{\Phi}^{(i)}}\boldsymbol{\Sigma}_{\boldsymbol{\Phi}^{(i)}}^{\frac{1}{2}}\boldsymbol{r}_q\right)}$ and matrices $\boldsymbol{\Phi}_q=\bar{\boldsymbol{\phi}}_q\bar{\boldsymbol{\phi}}_q^H  \ \forall q$
						\State Select the best solution $(\boldsymbol{\Phi}^{(i)})^\star$ and $(\boldsymbol{\phi}^{(i)})^\star$ for problem \ref{op:su_irs_wit}
						\State Update composite channel $(\boldsymbol{h}^{(i)})^\star$ by \ref{eq:h_k}
						\State Obtain optimal power allocation $(p_n^{(i)})^\star \ \forall n$ by water-filling algorithm
						\State Obtain optimal waveform phase $(\psi_{I,n}^{(i)})^\star \ \forall n$ by \ref{eq:psi}
						\State Update information waveform $(\boldsymbol{w}_I^{(i)})^\star$ by \ref{eq:w_{I,n}}
						\Until $\lvert (R^{(i)}-R^{(i-1)}) / R^{(i)} \rvert \le \epsilon$
						\State Compute phase shift by $\theta_l^\star=\arg(\phi_l^\star/\phi_{L+1}^\star), \ l=1,\dots,L$
						\State \textbf{Output} $\boldsymbol{w}_I^\star,\theta_l^\star \ \forall l$
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}
		\end{subsubsection}

		\begin{subsubsection}{R-E Sample}
			Denote $S$ as the number of samples in the R-E boundary. Starting from WIT mode, we initialize each following sample with the solution of the previous sample.
			\begin{paragraph}{FS-IRS}
				Since the optimal composite channel is fixed, we only optimize the splitting ratio and waveform by either GP or inner loop method. The procedure is included in Algorithm \ref{al:fs_ao}.
				\begin{algorithm}
					\caption{FS-IRS: AO Algorithm}
					\label{al:fs_ao}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}, P, Q, S, \epsilon, \sigma_n \ \forall n$
						\State \textbf{Initialize} $\rho_0^{\star} = 0$, $\boldsymbol{w}_{0,I}^{\star}$ by \ref{eq:w_{I,n}} and $\boldsymbol{w}_{0,P}^{\star} = \boldsymbol{0}$
						\For{$s \gets 1, S$}
						\State $i \gets 0$\label{st:inner_begin}
						\State Initialize splitting ratio and waveform by previous solution $\rho_s^{(0)} = \rho_{s-1}^{\star}, \boldsymbol{w}_{s,I/P}^{(0)}=\boldsymbol{w}_{s-1,I/P}^{\star}$
						\Repeat
						\State $i \gets i + 1$
						\State Update splitting ratio $\rho_s^{(i)}$ and waveform $\boldsymbol{w}_{s,I/P}^{(i)}$ by GP (Algorithm \ref{al:waveform_split_ratio_gp}) or inner loop (Algorithm \ref{al:inner_loop})
						\Until $\lvert (z_s^{(i)}-z_s^{(i-1)}) / z_s^{(i)} \rvert \le \epsilon$
						\State \textbf{Return} ($R_s^\star, z_s^\star$)
						\EndFor
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}

			\begin{paragraph}{FF-IRS}
				For SWIPT assisted by FF-IRS, we propose a two-layer AO algorithm to maximize the R-E region where the outer loop updates the phase shifts and the inner loop updates the splitting ratio and waveform until convergence. The algorithm is summarized in Algorithm \ref{al:ff_ao}.
				\begin{algorithm}
					\caption{FF-IRS: AO Algorithm}
					\label{al:ff_ao}
					\begin{algorithmic}[1]
						\State \textbf{Input} $\beta_2,\beta_4,\boldsymbol{h}_D, \boldsymbol{h}_I, \boldsymbol{h}_R, P, Q, S, \epsilon, \sigma_n \ \forall n$
						\State \textbf{Initialize} $\rho_0^{\star} = 0$, $\boldsymbol{\phi}_0^{\star}, \boldsymbol{w}_{0,I}^{\star}$ by Algorithm \ref{al:ff_wit} and $\boldsymbol{w}_{0,P}^{\star} = \boldsymbol{0}$
						\For{$s \gets 1, S$}
						\State $i \gets 0$
						\State Initialize IRS, splitting ratio and waveform by previous solution $\boldsymbol{\phi}_s^{(0)} = \boldsymbol{\phi}_{s-1}^{\star}, \rho_s^{(0)} = \rho_{s-1}^{\star}, \boldsymbol{w}_{s,I/P}^{(0)}=\boldsymbol{w}_{s-1,I/P}^{\star}$
						\State Initialize composite channel $\boldsymbol{h}_s^{(0)}$ by \ref{eq:h_k}
						\State Update splitting ratio $\rho_s^{(0)}$ and waveform $\boldsymbol{w}_{s,I/P}^{(0)}$ by GP (Algorithm \ref{al:waveform_split_ratio_gp}) or inner loop (Algorithm \ref{al:inner_loop})
						\Repeat
						\State $i \gets i + 1$
						\State Update IRS phase shift $\boldsymbol{\phi}_s^{(i)}$ by Algorithm \ref{al:ff_irs}
						\State Update composite channel $\boldsymbol{h}_s^{(i)}$ by \ref{eq:h_k}
						\State Update splitting ratio $\rho_s^{(i)}$ and waveform $\boldsymbol{w}_{s,I/P}^{(i)}$ by GP (Algorithm \ref{al:waveform_split_ratio_gp}) or inner loop (Algorithm \ref{al:inner_loop})
						\Until $\lvert (z_s^{(i)}-z_s^{(i-1)}) / z_s^{(i)} \rvert \le \epsilon$
						\State \textbf{Return} ($R_s^\star, z_s^\star$)
						\EndFor
					\end{algorithmic}
				\end{algorithm}
			\end{paragraph}
		\end{subsubsection}
	\end{subsection}
\end{section}

\bibliographystyle{IEEEtran}
\bibliography{library.bib}
\end{document}
